<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mydocs.guoyaxue.top/codenotes/Java/jvm/11.html"><meta property="og:site_name" content="å°uã®å­¦ä¹ ç¬”è®°"><meta property="og:title" content="JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"><meta property="og:description" content="JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µã€‚"><meta property="og:type" content="article"><meta property="og:image" content="https://npm.elemecdn.com/lql_static@latest/logo/jvm.png"><meta property="og:updated_time" content="2023-08-02T10:33:49.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"><meta property="article:tag" content="JVM"><meta property="article:tag" content="è™šæ‹Ÿæœº"><meta property="article:modified_time" content="2023-08-02T10:33:49.000Z"><link rel="icon" href="/favicon.svg"><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ef5d300e271d63833a52446f97a78f7d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
     </script><title>JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ | å°uã®å­¦ä¹ ç¬”è®°</title><meta name="description" content="JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.e2ddb5bf.css" as="style" /><link rel="stylesheet" href="/assets/style.e2ddb5bf.css" />
    <link rel="modulepreload" href="/assets/app.c5b3201b.js"><link rel="modulepreload" href="/assets/11.html.5c6b2481.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/11.html.77961b7e.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/site_logo.png" alt="å°uã®å­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">å°uã®å­¦ä¹ ç¬”è®°</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/quicknav/" class="nav-link" aria-label="å¿«é€Ÿå¯¼èˆª"><span class="icon iconfont icon-navigation"></span>å¿«é€Ÿå¯¼èˆª<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="åšå®¢ä¸»é¡µ"><span class="icon iconfont icon-blog"></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/codenotes/" class="nav-link active" aria-label="ä»£ç ç¬”è®°"><span class="icon iconfont icon-code"></span>ä»£ç ç¬”è®°<!----></a></div><div class="nav-item hide-in-mobile"><a href="/projects/" class="nav-link" aria-label="æŠ€æœ¯æ‚è°ˆ"><span class="icon iconfont icon-code"></span>æŠ€æœ¯æ‚è°ˆ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/interview/" class="nav-link" aria-label="é¢è¯•"><span class="icon iconfont icon-code"></span>é¢è¯•<!----></a></div><div class="nav-item hide-in-mobile"><a href="/practice/" class="nav-link" aria-label="é¡¹ç›®å®æˆ˜"><span class="icon iconfont icon-code"></span>é¡¹ç›®å®æˆ˜<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://gitee.com/lizifan233/mydocs" target="_blank" rel="noopener noreferrer" aria-label="Gitee"><svg xmlns="http://www.w3.org/2000/svg" class="icon gitee-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="gitee icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm242.97-533.34H482.39a23.7 23.7 0 0 0-23.7 23.7l-.03 59.28c0 13.08 10.59 23.7 23.7 23.7h165.96a23.7 23.7 0 0 1 23.7 23.7v11.85a71.1 71.1 0 0 1-71.1 71.1H375.71a23.7 23.7 0 0 1-23.7-23.7V423.11a71.1 71.1 0 0 1 71.1-71.1h331.8a23.7 23.7 0 0 0 23.7-23.7l.06-59.25a23.73 23.73 0 0 0-23.7-23.73H423.11a177.78 177.78 0 0 0-177.78 177.75v331.83c0 13.08 10.62 23.7 23.7 23.7h349.62a159.99 159.99 0 0 0 159.99-159.99V482.33a23.7 23.7 0 0 0-23.7-23.7z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢æœ¬ç«™" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-java"></span><span class="title">Java</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-write"></span><span class="title">JavaSEç²¾ä¿®</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-write"></span><span class="title">é‡å­¦Java(åƒé”‹æ•™è‚²2023)</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-write"></span><span class="title">JVM(å°šç¡…è°·)</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/codenotes/Java/jvm/1.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬1ç« -JVMä¸Javaä½“ç³»ç»“æ„"><!---->JVMç³»åˆ—-ç¬¬1ç« -JVMä¸Javaä½“ç³»ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/2.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬2ç« -ç±»åŠ è½½å­ç³»ç»Ÿ"><!---->JVMç³»åˆ—-ç¬¬2ç« -ç±»åŠ è½½å­ç³»ç»Ÿ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/3.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬3ç« -è¿è¡Œæ—¶æ•°æ®åŒº"><!---->JVMç³»åˆ—-ç¬¬3ç« -è¿è¡Œæ—¶æ•°æ®åŒº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/4.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬4ç« -è™šæ‹Ÿæœºæ ˆ"><!---->JVMç³»åˆ—-ç¬¬4ç« -è™šæ‹Ÿæœºæ ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/5.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬5ç« -å †"><!---->JVMç³»åˆ—-ç¬¬5ç« -å †<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/6.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬6ç« -æ–¹æ³•åŒº"><!---->JVMç³»åˆ—-ç¬¬6ç« -æ–¹æ³•åŒº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/7.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬7ç« -å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½"><!---->JVMç³»åˆ—-ç¬¬7ç« -å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/8.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬8ç« -æ‰§è¡Œå¼•æ“"><!---->JVMç³»åˆ—-ç¬¬8ç« -æ‰§è¡Œå¼•æ“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/9.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬9ç« -StringTable(å­—ç¬¦ä¸²å¸¸é‡æ± )"><!---->JVMç³»åˆ—-ç¬¬9ç« -StringTable(å­—ç¬¦ä¸²å¸¸é‡æ± )<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/10.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬10ç« -åƒåœ¾å›æ”¶æ¦‚è¿°å’Œç›¸å…³ç®—æ³•"><!---->JVMç³»åˆ—-ç¬¬10ç« -åƒåœ¾å›æ”¶æ¦‚è¿°å’Œç›¸å…³ç®—æ³•<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/codenotes/Java/jvm/11.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"><!---->JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#system-gc-çš„ç†è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="System.gc() çš„ç†è§£"><!---->System.gc() çš„ç†è§£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#æ‰‹åŠ¨-gc-ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ‰‹åŠ¨ GC ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º"><!---->æ‰‹åŠ¨ GC ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼"><!---->å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†…å­˜æº¢å‡º" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†…å­˜æº¢å‡º"><!---->å†…å­˜æº¢å‡º<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†…å­˜æ³„æ¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†…å­˜æ³„æ¼"><!---->å†…å­˜æ³„æ¼<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#stop-the-world" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Stop the World"><!---->Stop the World<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#ä»£ç æ„Ÿå—-stop-the-world" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»£ç æ„Ÿå— Stop the World"><!---->ä»£ç æ„Ÿå— Stop the World<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘"><!---->åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å¹¶å‘çš„æ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¹¶å‘çš„æ¦‚å¿µ"><!---->å¹¶å‘çš„æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å¹¶è¡Œçš„æ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¹¶è¡Œçš„æ¦‚å¿µ"><!---->å¹¶è¡Œçš„æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ"><!---->åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#hotspotçš„ç®—æ³•å®ç°ç»†èŠ‚" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="HotSpotçš„ç®—æ³•å®ç°ç»†èŠ‚"><!---->HotSpotçš„ç®—æ³•å®ç°ç»†èŠ‚<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#æ ¹èŠ‚ç‚¹æšä¸¾" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ ¹èŠ‚ç‚¹æšä¸¾"><!---->æ ¹èŠ‚ç‚¹æšä¸¾<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ"><!---->å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#è®°å¿†é›†ä¸å¡è¡¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è®°å¿†é›†ä¸å¡è¡¨"><!---->è®°å¿†é›†ä¸å¡è¡¨<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨æ¦‚è¿°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†è°ˆå¼•ç”¨æ¦‚è¿°"><!---->å†è°ˆå¼•ç”¨æ¦‚è¿°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-å¼ºå¼•ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨"><!---->å†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-è½¯å¼•ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†è°ˆå¼•ç”¨ï¼šè½¯å¼•ç”¨"><!---->å†è°ˆå¼•ç”¨ï¼šè½¯å¼•ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-å¼±å¼•ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨"><!---->å†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-è™šå¼•ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨"><!---->å†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-ç»ˆç»“å™¨å¼•ç”¨-äº†è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†è°ˆå¼•ç”¨ï¼šç»ˆç»“å™¨å¼•ç”¨ï¼ˆäº†è§£ï¼‰"><!---->å†è°ˆå¼•ç”¨ï¼šç»ˆç»“å™¨å¼•ç”¨ï¼ˆäº†è§£ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/codenotes/Java/jvm/12.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMç³»åˆ—-ç¬¬12ç« -åƒåœ¾å›æ”¶å™¨"><!---->JVMç³»åˆ—-ç¬¬12ç« -åƒåœ¾å›æ”¶å™¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-write"></span><span class="title">JVM(doocs)</span><span class="arrow right"></span></button><!----></section></li><li><!--[--><a href="/codenotes/Java/spring6.html" class="nav-link sidebar-link sidebar-page" aria-label="spring6"><span class="icon iconfont icon-write"></span>spring6<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-write"></span><span class="title">coder1v5ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-write"></span><span class="title">è®¾è®¡æ¨¡å¼(é»‘é©¬)</span><span class="arrow right"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-html"></span><span class="title">å‰ç«¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">ç®—æ³•</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-python"></span><span class="title">python</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-workingDirectory"></span><span class="title">å…¶ä»–æŠ€æœ¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linter"></span><span class="title">é€†å‘</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linter"></span><span class="title">æ¨èä¹¦ç±</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->JVMç³»åˆ—-ç¬¬11ç« -åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</h1><div class="page-info"><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 35 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT35M"></span><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-08-02T10:33:49.000Z"></span><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 10396 å­—</span><meta property="wordCount" content="10396"></span><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://gitee.com/lizifan233/mydocs" target="_blank" rel="noopener noreferrer">Xiaou</a></span><span property="author" content="Xiaou"></span></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#system-gc-çš„ç†è§£" class="router-link-active router-link-exact-active toc-link level2">System.gc() çš„ç†è§£</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#æ‰‹åŠ¨-gc-ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º" class="router-link-active router-link-exact-active toc-link level3">æ‰‹åŠ¨ GC ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼" class="router-link-active router-link-exact-active toc-link level2">å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†…å­˜æº¢å‡º" class="router-link-active router-link-exact-active toc-link level3">å†…å­˜æº¢å‡º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†…å­˜æ³„æ¼" class="router-link-active router-link-exact-active toc-link level3">å†…å­˜æ³„æ¼</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#stop-the-world" class="router-link-active router-link-exact-active toc-link level2">Stop the World</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#ä»£ç æ„Ÿå—-stop-the-world" class="router-link-active router-link-exact-active toc-link level3">ä»£ç æ„Ÿå— Stop the World</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘" class="router-link-active router-link-exact-active toc-link level2">åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å¹¶å‘çš„æ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level3">å¹¶å‘çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å¹¶è¡Œçš„æ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level3">å¹¶è¡Œçš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ" class="router-link-active router-link-exact-active toc-link level3">åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#hotspotçš„ç®—æ³•å®ç°ç»†èŠ‚" class="router-link-active router-link-exact-active toc-link level2">HotSpotçš„ç®—æ³•å®ç°ç»†èŠ‚</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#æ ¹èŠ‚ç‚¹æšä¸¾" class="router-link-active router-link-exact-active toc-link level3">æ ¹èŠ‚ç‚¹æšä¸¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ" class="router-link-active router-link-exact-active toc-link level3">å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#è®°å¿†é›†ä¸å¡è¡¨" class="router-link-active router-link-exact-active toc-link level3">è®°å¿†é›†ä¸å¡è¡¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">å†è°ˆå¼•ç”¨æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-å¼ºå¼•ç”¨" class="router-link-active router-link-exact-active toc-link level2">å†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-è½¯å¼•ç”¨" class="router-link-active router-link-exact-active toc-link level2">å†è°ˆå¼•ç”¨ï¼šè½¯å¼•ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-å¼±å¼•ç”¨" class="router-link-active router-link-exact-active toc-link level2">å†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-è™šå¼•ç”¨" class="router-link-active router-link-exact-active toc-link level2">å†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/codenotes/Java/jvm/11.html#å†è°ˆå¼•ç”¨-ç»ˆç»“å™¨å¼•ç”¨-äº†è§£" class="router-link-active router-link-exact-active toc-link level2">å†è°ˆå¼•ç”¨ï¼šç»ˆç»“å™¨å¼•ç”¨ï¼ˆäº†è§£ï¼‰</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ" aria-hidden="true">#</a> åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</h1><h2 id="system-gc-çš„ç†è§£" tabindex="-1"><a class="header-anchor" href="#system-gc-çš„ç†è§£" aria-hidden="true">#</a> System.gc() çš„ç†è§£</h2><ol><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡System.gc()è€…Runtime.getRuntime().gc() çš„è°ƒç”¨ï¼Œ<strong>ä¼šæ˜¾å¼è§¦å‘Full GC</strong>ï¼ŒåŒæ—¶å¯¹è€å¹´ä»£å’Œæ–°ç”Ÿä»£è¿›è¡Œå›æ”¶ï¼Œå°è¯•é‡Šæ”¾è¢«ä¸¢å¼ƒå¯¹è±¡å ç”¨çš„å†…å­˜ã€‚</p></li><li><p>ç„¶è€ŒSystem.gc()è°ƒç”¨é™„å¸¦ä¸€ä¸ªå…è´£å£°æ˜ï¼Œæ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨(ä¸èƒ½ç¡®ä¿ç«‹å³ç”Ÿæ•ˆ)</p></li><li><p>JVMå®ç°è€…å¯ä»¥é€šè¿‡System.gc() è°ƒç”¨æ¥å†³å®šJVMçš„GCè¡Œä¸ºã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶åº”è¯¥æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œ**æ— é¡»æ‰‹åŠ¨è§¦å‘ï¼Œå¦åˆ™å°±å¤ªè¿‡äºéº»çƒ¦äº†ã€‚**åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ€§èƒ½åŸºå‡†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œä¹‹é—´è°ƒç”¨System.gc()</p></li></ol><p><strong>ä»£ç ç¤ºä¾‹ï¼šæ‰‹åŠ¨æ‰§è¡Œ GC æ“ä½œ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SystemGCTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">SystemGCTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æé†’jvmçš„åƒåœ¾å›æ”¶å™¨æ‰§è¡Œgc,ä½†æ˜¯ä¸ç¡®å®šæ˜¯å¦é©¬ä¸Šæ‰§è¡Œgc</span>
        <span class="token comment">//ä¸Runtime.getRuntime().gc();çš„ä½œç”¨ä¸€æ ·ã€‚</span>

<span class="token comment">//        System.runFinalization();//å¼ºåˆ¶è°ƒç”¨ä½¿ç”¨å¼•ç”¨çš„å¯¹è±¡çš„finalize()æ–¹æ³•</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¦‚æœå‘ç”Ÿäº†GCï¼Œè¿™ä¸ªfinalize()ä¸€å®šä¼šè¢«è°ƒç”¨</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SystemGCTest é‡å†™äº†finalize()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœä¸ç¡®å®šï¼šæœ‰æ—¶å€™ä¼šè°ƒç”¨ finalize() æ–¹æ³•ï¼Œæœ‰æ—¶å€™å¹¶ä¸ä¼šè°ƒç”¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SystemGCTest</span> é‡å†™äº†<span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
æˆ–
ç©º
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰‹åŠ¨-gc-ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#æ‰‹åŠ¨-gc-ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º" aria-hidden="true">#</a> æ‰‹åŠ¨ GC ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶è¡Œä¸º</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åŠ ä¸Šå‚æ•°ï¼š  -XX:+PrintGCDetails</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalVarGC</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//10MB</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        buffer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">localvarGC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LocalVarGC</span> local <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalVarGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é€šè¿‡åœ¨mainæ–¹æ³•è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•</span>
        local<span class="token punctuation">.</span><span class="token function">localvarGC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JVMå‚æ•°ï¼š</p><p><code>-Xms256m -Xmx256m -XX:+PrintGCDetails -XX:PretenureSizeThreshold=15m</code></p><p>1ã€ç¬¬å››ä¸ªå‚æ•°æ˜¯è®¾ç½®å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„é˜ˆå€¼ï¼Œç”±äºæˆ‘çš„ç”µè„‘8Gå’Œè§†é¢‘é‡Œè€å¸ˆçš„ç”µè„‘16Gä¸å¤ªä¸€æ ·ã€‚æˆ‘æµ‹è¯•çš„æ—¶å€™10Mçš„æ•°ç»„éƒ½æ˜¯ç›´æ¥è¿›å…¥åˆ°äº†è€å¹´ä»£ï¼Œä¸ºäº†ä¿æŒä¸€æ ·çš„æ•ˆæœï¼Œæˆ‘åŒæ—¶è®¾ç½®äº†å †å†…å­˜å’Œå¤§å¯¹è±¡é˜ˆå€¼ï¼Œå°½é‡å’Œå®‹çº¢åº·è€å¸ˆä¿æŒä¸€è‡´</p><p>2ã€æˆ‘ä¹ŸæŸ¥è¿‡äº†å¤§å¯¹è±¡é˜ˆå€¼çš„é»˜è®¤å€¼</p><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0001.png"><p>æˆ‘ä¸å¤ªæ‡‚è¿™ä¸ªé»˜è®¤å€¼ä¸ºå•¥æ˜¯0ï¼Œæˆ‘çŒœæµ‹å¯èƒ½æ˜¯ä»£è¡¨ä»€ä¹ˆæ¯”ä¾‹ï¼Œç›®å‰ä¹Ÿæ²¡æœ‰æœåˆ°ç›¸å…³çš„ä¸œè¥¿ã€‚è¿™ä¸ªä¸å¤ªé‡è¦ï¼Œæš‚æ—¶å°±æ²¡æœ‰å¤ªæ·±ç©¶ï¼Œå¸Œæœ›è¯»è€…æœ‰çŸ¥é“çš„å¯ä»¥å‘ŠçŸ¥æˆ‘ä¸€å£°ã€‚</p><blockquote><p>çœ‹ä¸æ‡‚GCæ—¥å¿—è¯·çœ‹ç¬”è€…çš„ <strong>å †</strong>é‚£ç¯‡æ–‡ç« </p></blockquote><p><strong>1ã€è°ƒç”¨ localvarGC1() æ–¹æ³•</strong></p><p>æ‰§è¡Œ System.gc() ä»…ä»…æ˜¯å°†å¹´è½»ä»£çš„ buffer æ•°ç»„å¯¹è±¡æ”¾åˆ°äº†è€å¹´ä»£ï¼Œbufferå¯¹è±¡ä»ç„¶æ²¡æœ‰å›æ”¶</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span><span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">10728K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">11000K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0066473</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.08</span> sys<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token class-name">Full</span> <span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">10728</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">272</span>K<span class="token operator">-&gt;</span><span class="token function">10911K</span><span class="token punctuation">(</span><span class="token number">175104</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">11000</span>K<span class="token operator">-&gt;</span><span class="token function">10911K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name">Metaspace</span><span class="token operator">:</span> <span class="token number">3492</span>K<span class="token operator">-&gt;</span><span class="token function">3492K</span><span class="token punctuation">(</span><span class="token number">1056768</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0097940</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token class-name">Heap</span>
 <span class="token class-name">PSYoungGen</span>      total <span class="token number">76288</span>K<span class="token punctuation">,</span> used <span class="token number">655</span>K <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
  eden space <span class="token number">65536</span>K<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span><span class="token number">0x00000000faba3ee8</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">)</span>
  from space <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">)</span>
  <span class="token keyword">to</span>   <span class="token namespace">space</span> <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
 <span class="token class-name">ParOldGen</span>       total <span class="token number">175104</span>K<span class="token punctuation">,</span> used <span class="token number">10911</span>K <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
  object space <span class="token number">175104</span>K<span class="token punctuation">,</span> <span class="token number">6</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span><span class="token number">0x00000000f0aa7d08</span><span class="token punctuation">,</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
 <span class="token class-name">Metaspace</span>       used <span class="token number">3498</span>K<span class="token punctuation">,</span> capacity <span class="token number">4498</span>K<span class="token punctuation">,</span> committed <span class="token number">4864</span>K<span class="token punctuation">,</span> reserved <span class="token number">1056768</span>K
  <span class="token keyword">class</span> space    used <span class="token number">387</span>K<span class="token punctuation">,</span> capacity <span class="token number">390</span>K<span class="token punctuation">,</span> committed <span class="token number">512</span>K<span class="token punctuation">,</span> reserved <span class="token number">1048576</span>K
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2ã€è°ƒç”¨ localvarGC2() æ–¹æ³•</strong></p><p>ç”±äº buffer æ•°ç»„å¯¹è±¡æ²¡æœ‰å¼•ç”¨æŒ‡å‘å®ƒï¼Œæ‰§è¡Œ System.gc() å°†è¢«å›æ”¶</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span><span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">808K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">816K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0294475</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.04</span> secs<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token class-name">Full</span> <span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">808</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">8</span>K<span class="token operator">-&gt;</span><span class="token function">640K</span><span class="token punctuation">(</span><span class="token number">175104</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">816</span>K<span class="token operator">-&gt;</span><span class="token function">640K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name">Metaspace</span><span class="token operator">:</span> <span class="token number">3385</span>K<span class="token operator">-&gt;</span><span class="token function">3385K</span><span class="token punctuation">(</span><span class="token number">1056768</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0054210</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token class-name">Heap</span>
 <span class="token class-name">PSYoungGen</span>      total <span class="token number">76288</span>K<span class="token punctuation">,</span> used <span class="token number">1966</span>K <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
  eden space <span class="token number">65536</span>K<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span><span class="token number">0x00000000faceb9e0</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">)</span>
  from space <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">)</span>
  <span class="token keyword">to</span>   <span class="token namespace">space</span> <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
 <span class="token class-name">ParOldGen</span>       total <span class="token number">175104</span>K<span class="token punctuation">,</span> used <span class="token number">640</span>K <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
  object space <span class="token number">175104</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span><span class="token number">0x00000000f00a01a8</span><span class="token punctuation">,</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
 <span class="token class-name">Metaspace</span>       used <span class="token number">3392</span>K<span class="token punctuation">,</span> capacity <span class="token number">4496</span>K<span class="token punctuation">,</span> committed <span class="token number">4864</span>K<span class="token punctuation">,</span> reserved <span class="token number">1056768</span>K
  <span class="token keyword">class</span> space    used <span class="token number">379</span>K<span class="token punctuation">,</span> capacity <span class="token number">388</span>K<span class="token punctuation">,</span> committed <span class="token number">512</span>K<span class="token punctuation">,</span> reserved <span class="token number">1048576</span>K
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3ã€è°ƒç”¨ localvarGC3() æ–¹æ³•</strong></p><p>è™½ç„¶å‡ºäº†ä»£ç å—çš„ä½œç”¨åŸŸï¼Œä½†æ˜¯ buffer æ•°ç»„å¯¹è±¡å¹¶æ²¡æœ‰è¢«å›æ”¶</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span><span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">840K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">11088K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0070281</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.08</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token class-name">Full</span> <span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">840</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">10248</span>K<span class="token operator">-&gt;</span><span class="token function">10900K</span><span class="token punctuation">(</span><span class="token number">175104</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">11088</span>K<span class="token operator">-&gt;</span><span class="token function">10900K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name">Metaspace</span><span class="token operator">:</span> <span class="token number">3386</span>K<span class="token operator">-&gt;</span><span class="token function">3386K</span><span class="token punctuation">(</span><span class="token number">1056768</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0084464</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token class-name">Heap</span>
 <span class="token class-name">PSYoungGen</span>      total <span class="token number">76288</span>K<span class="token punctuation">,</span> used <span class="token number">1966</span>K <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
  eden space <span class="token number">65536</span>K<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span><span class="token number">0x00000000faceb9e0</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">)</span>
  from space <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">)</span>
  <span class="token keyword">to</span>   <span class="token namespace">space</span> <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
 <span class="token class-name">ParOldGen</span>       total <span class="token number">175104</span>K<span class="token punctuation">,</span> used <span class="token number">10900</span>K <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
  object space <span class="token number">175104</span>K<span class="token punctuation">,</span> <span class="token number">6</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span><span class="token number">0x00000000f0aa52e8</span><span class="token punctuation">,</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
 <span class="token class-name">Metaspace</span>       used <span class="token number">3393</span>K<span class="token punctuation">,</span> capacity <span class="token number">4496</span>K<span class="token punctuation">,</span> committed <span class="token number">4864</span>K<span class="token punctuation">,</span> reserved <span class="token number">1056768</span>K
  <span class="token keyword">class</span> space    used <span class="token number">379</span>K<span class="token punctuation">,</span> capacity <span class="token number">388</span>K<span class="token punctuation">,</span> committed <span class="token number">512</span>K<span class="token punctuation">,</span> reserved <span class="token number">1048576</span>K
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åŸå› ï¼š</strong></p><p>1ã€æ¥çœ‹çœ‹å­—èŠ‚ç ï¼šå®ä¾‹æ–¹æ³•å±€éƒ¨å˜é‡è¡¨ç¬¬ä¸€ä¸ªå˜é‡è‚¯å®šæ˜¯ this</p><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0002.png"><p>2ã€ä½ æœ‰æ²¡æœ‰çœ‹åˆ°ï¼Œå±€éƒ¨å˜é‡è¡¨çš„å¤§å°æ˜¯ 2ã€‚ä½†æ˜¯å±€éƒ¨å˜é‡è¡¨é‡Œåªæœ‰ä¸€ä¸ªç´¢å¼•ä¸º0çš„å•Šï¼Ÿé‚£ç´¢å¼•ä¸º1çš„æ˜¯å“ªä¸ªå±€éƒ¨å˜é‡å‘¢ï¼Ÿå®é™…ä¸Šç´¢å¼•ä¸º1çš„ä½ç½®æ˜¯bufferåœ¨å ç”¨ç€ï¼Œæ‰§è¡Œ System.gc() æ—¶ï¼Œæ ˆä¸­è¿˜æœ‰ buffer å˜é‡æŒ‡å‘å †ä¸­çš„å­—èŠ‚æ•°ç»„ï¼Œæ‰€ä»¥æ²¡æœ‰è¿›è¡ŒGC</p><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0003.png"><p>3ã€é‚£ä¹ˆè¿™ç§ä»£ç å—çš„æƒ…å†µï¼Œä»€ä¹ˆæ—¶å€™ä¼šè¢«GCå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ç¬¬å››ä¸ªæ–¹æ³•</p><p><strong>4ã€è°ƒç”¨ localvarGC4() æ–¹æ³•</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[GC (System.gc()) [PSYoungGen: 15492K-&gt;776K(76288K)] 15492K-&gt;784K(251392K), 0.0009430 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
[Full GC (System.gc()) [PSYoungGen: 776K-&gt;0K(76288K)] [ParOldGen: 8K-&gt;646K(175104K)] 784K-&gt;646K(251392K), [Metaspace: 3485K-&gt;3485K(1056768K)], 0.0065829 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] 
Heap
 PSYoungGen      total 76288K, used 1966K [0x00000000fab00000, 0x0000000100000000, 0x0000000100000000)
  eden space 65536K, 3% used [0x00000000fab00000,0x00000000faceb9f8,0x00000000feb00000)
  from space 10752K, 0% used [0x00000000feb00000,0x00000000feb00000,0x00000000ff580000)
  to   space 10752K, 0% used [0x00000000ff580000,0x00000000ff580000,0x0000000100000000)
 ParOldGen       total 175104K, used 646K [0x00000000f0000000, 0x00000000fab00000, 0x00000000fab00000)
  object space 175104K, 0% used [0x00000000f0000000,0x00000000f00a1b88,0x00000000fab00000)
 Metaspace       used 3498K, capacity 4498K, committed 4864K, reserved 1056768K
  class space    used 387K, capacity 390K, committed 512K, reserved 1048576K
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Qï¼šå°±å¤šå®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ value ï¼Œå°±å¯ä»¥æŠŠå­—èŠ‚æ•°ç»„å›æ”¶äº†å‘¢ï¼Ÿ</p><p>Aï¼šå±€éƒ¨å˜é‡è¡¨é•¿åº¦ä¸º 2 ï¼Œè¿™è¯´æ˜äº†å‡ºäº†ä»£ç å—æ—¶ï¼Œbuffer å°±å‡ºäº†å…¶ä½œç”¨åŸŸèŒƒå›´ï¼Œæ­¤æ—¶æ²¡æœ‰ä¸º value å¼€å¯æ–°çš„æ§½ï¼Œvalue å˜é‡ç›´æ¥å æ®äº† buffer å˜é‡çš„æ§½ï¼ˆSlotï¼‰ï¼Œå¯¼è‡´å †ä¸­çš„å­—èŠ‚æ•°ç»„æ²¡æœ‰å¼•ç”¨å†æŒ‡å‘å®ƒï¼Œæ‰§è¡Œ System.gc() æ—¶è¢«å›æ”¶ã€‚çœ‹ï¼Œvalue ä½äºå±€éƒ¨å˜é‡è¡¨ä¸­ç´¢å¼•ä¸º 1 çš„ä½ç½®ã€‚valueè¿™ä¸ªå±€éƒ¨å˜é‡æŠŠåŸæœ¬å±äºbufferçš„slotç»™å ç”¨äº†ï¼Œè¿™æ ·æ ˆä¸Šå°±æ²¡æœ‰bufferå˜é‡æŒ‡å‘<code>new byte[10 * 1024 * 1024]</code>å®ä¾‹äº†ã€‚</p><blockquote><p>è¿™ç‚¹çœ‹ä¸æ‡‚çš„å¯ä»¥çœ‹æˆ‘å‰é¢çš„æ–‡ç« ï¼šè™šæ‹Ÿæœºæ ˆ --&gt; Slotçš„é‡å¤åˆ©ç”¨</p></blockquote><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0004.png"><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0005.png"><p><strong>è°ƒç”¨ localvarGC5() æ–¹æ³•</strong></p><p>å±€éƒ¨å˜é‡é™¤äº†æ–¹æ³•èŒƒå›´å°±æ˜¯å¤±æ•ˆäº†ï¼Œå †ä¸­çš„å­—èŠ‚æ•°ç»„é“å®šè¢«å›æ”¶</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span><span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">840K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">15492</span>K<span class="token operator">-&gt;</span><span class="token function">11088K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0070281</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token class-name">Full</span> <span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">840</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">10248</span>K<span class="token operator">-&gt;</span><span class="token function">10911K</span><span class="token punctuation">(</span><span class="token number">175104</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">11088</span>K<span class="token operator">-&gt;</span><span class="token function">10911K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name">Metaspace</span><span class="token operator">:</span> <span class="token number">3492</span>K<span class="token operator">-&gt;</span><span class="token function">3492K</span><span class="token punctuation">(</span><span class="token number">1056768</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0082011</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.03</span> sys<span class="token operator">=</span><span class="token number">0.03</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">0</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">10911</span>K<span class="token operator">-&gt;</span><span class="token function">10911K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0004440</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.00</span> secs<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token class-name">Full</span> <span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">0</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">10911</span>K<span class="token operator">-&gt;</span><span class="token function">671K</span><span class="token punctuation">(</span><span class="token number">175104</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">10911</span>K<span class="token operator">-&gt;</span><span class="token function">671K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name">Metaspace</span><span class="token operator">:</span> <span class="token number">3492</span>K<span class="token operator">-&gt;</span><span class="token function">3492K</span><span class="token punctuation">(</span><span class="token number">1056768</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0108555</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.08</span> sys<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token class-name">Heap</span>
 <span class="token class-name">PSYoungGen</span>      total <span class="token number">76288</span>K<span class="token punctuation">,</span> used <span class="token number">655</span>K <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">,</span> <span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
  eden space <span class="token number">65536</span>K<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span><span class="token number">0x00000000faba3ee8</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">)</span>
  from space <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">,</span><span class="token number">0x0000000100000000</span><span class="token punctuation">)</span>
  <span class="token keyword">to</span>   <span class="token namespace">space</span> <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000feb00000</span><span class="token punctuation">,</span><span class="token number">0x00000000ff580000</span><span class="token punctuation">)</span>
 <span class="token class-name">ParOldGen</span>       total <span class="token number">175104</span>K<span class="token punctuation">,</span> used <span class="token number">671</span>K <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">,</span> <span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
  object space <span class="token number">175104</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000f0000000</span><span class="token punctuation">,</span><span class="token number">0x00000000f00a7cf8</span><span class="token punctuation">,</span><span class="token number">0x00000000fab00000</span><span class="token punctuation">)</span>
 <span class="token class-name">Metaspace</span>       used <span class="token number">3499</span>K<span class="token punctuation">,</span> capacity <span class="token number">4502</span>K<span class="token punctuation">,</span> committed <span class="token number">4864</span>K<span class="token punctuation">,</span> reserved <span class="token number">1056768</span>K
  <span class="token keyword">class</span> space    used <span class="token number">387</span>K<span class="token punctuation">,</span> capacity <span class="token number">390</span>K<span class="token punctuation">,</span> committed <span class="token number">512</span>K<span class="token punctuation">,</span> reserved <span class="token number">1048576</span>K
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼" aria-hidden="true">#</a> å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼</h2><h3 id="å†…å­˜æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#å†…å­˜æº¢å‡º" aria-hidden="true">#</a> å†…å­˜æº¢å‡º</h3><ol><li>å†…å­˜æº¢å‡ºç›¸å¯¹äºå†…å­˜æ³„æ¼æ¥è¯´ï¼Œå°½ç®¡æ›´å®¹æ˜“è¢«ç†è§£ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œå†…å­˜æº¢å‡ºä¹Ÿæ˜¯å¼•å‘ç¨‹åºå´©æºƒçš„ç½ªé­ç¥¸é¦–ä¹‹ä¸€ã€‚</li><li>ç”±äºGCä¸€ç›´åœ¨å‘å±•ï¼Œæ‰€æœ‰ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤éåº”ç”¨ç¨‹åºå ç”¨çš„å†…å­˜å¢é•¿é€Ÿåº¦éå¸¸å¿«ï¼Œé€ æˆåƒåœ¾å›æ”¶å·²ç»è·Ÿä¸ä¸Šå†…å­˜æ¶ˆè€—çš„é€Ÿåº¦ï¼Œå¦åˆ™ä¸å¤ªå®¹æ˜“å‡ºç°OOMçš„æƒ…å†µã€‚</li><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒGCä¼šè¿›è¡Œå„ç§å¹´é¾„æ®µçš„åƒåœ¾å›æ”¶ï¼Œå®åœ¨ä¸è¡Œäº†å°±æ”¾å¤§æ‹›ï¼Œæ¥ä¸€æ¬¡ç‹¬å å¼çš„Full GCæ“ä½œï¼Œè¿™æ—¶å€™ä¼šå›æ”¶å¤§é‡çš„å†…å­˜ï¼Œä¾›åº”ç”¨ç¨‹åºç»§ç»­ä½¿ç”¨ã€‚</li><li>Javadocä¸­å¯¹OutofMemoryErrorçš„è§£é‡Šæ˜¯ï¼Œæ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œå¹¶ä¸”åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜ã€‚</li></ol><p><strong>å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰åŸå› åˆ†æ</strong></p><p>é¦–å…ˆè¯´æ²¡æœ‰ç©ºé—²å†…å­˜çš„æƒ…å†µï¼šè¯´æ˜Javaè™šæ‹Ÿæœºçš„å †å†…å­˜ä¸å¤Ÿã€‚åŸå› æœ‰äºŒï¼š</p><ol><li><p>Javaè™šæ‹Ÿæœºçš„å †å†…å­˜è®¾ç½®ä¸å¤Ÿã€‚</p><ul><li>æ¯”å¦‚ï¼šå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼›ä¹Ÿå¾ˆæœ‰å¯èƒ½å°±æ˜¯å †çš„å¤§å°ä¸åˆç†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å¤„ç†æ¯”è¾ƒå¯è§‚çš„æ•°æ®é‡ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾å¼æŒ‡å®šJVMå †å¤§å°æˆ–è€…æŒ‡å®šæ•°å€¼åå°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°-Xms ã€-Xmxæ¥è°ƒæ•´ã€‚</li></ul></li><li><p>ä»£ç ä¸­åˆ›å»ºäº†å¤§é‡å¤§å¯¹è±¡ï¼Œå¹¶ä¸”é•¿æ—¶é—´ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨æ”¶é›†ï¼ˆå­˜åœ¨è¢«å¼•ç”¨ï¼‰</p><ul><li>å¯¹äºè€ç‰ˆæœ¬çš„Oracle JDKï¼Œå› ä¸ºæ°¸ä¹…ä»£çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”JVMå¯¹æ°¸ä¹…ä»£åƒåœ¾å›æ”¶ï¼ˆå¦‚ï¼Œå¸¸é‡æ± å›æ”¶ã€å¸è½½ä¸å†éœ€è¦çš„ç±»å‹ï¼‰éå¸¸ä¸ç§¯æï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä¸æ–­æ·»åŠ æ–°ç±»å‹çš„æ—¶å€™ï¼Œæ°¸ä¹…ä»£å‡ºç°OutOfMemoryErrorä¹Ÿéå¸¸å¤šè§ã€‚å°¤å…¶æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨å¤§é‡åŠ¨æ€ç±»å‹ç”Ÿæˆçš„åœºåˆï¼›ç±»ä¼¼internå­—ç¬¦ä¸²ç¼“å­˜å ç”¨å¤ªå¤šç©ºé—´ï¼Œä¹Ÿä¼šå¯¼è‡´OOMé—®é¢˜ã€‚å¯¹åº”çš„å¼‚å¸¸ä¿¡æ¯ï¼Œä¼šæ ‡è®°å‡ºæ¥å’Œæ°¸ä¹…ä»£ç›¸å…³ï¼šâ€œjava.lang.OutOfMemoryError:PermGen space&quot;ã€‚</li><li>éšç€å…ƒæ•°æ®åŒºçš„å¼•å…¥ï¼Œæ–¹æ³•åŒºå†…å­˜å·²ç»ä¸å†é‚£ä¹ˆçª˜è¿«ï¼Œæ‰€ä»¥ç›¸åº”çš„OOMæœ‰æ‰€æ”¹è§‚ï¼Œå‡ºç°OOMï¼Œå¼‚å¸¸ä¿¡æ¯åˆ™å˜æˆäº†ï¼šâ€œjava.lang.OutofMemoryError:Metaspace&quot;ã€‚ç›´æ¥å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´OOMã€‚</li></ul></li><li><p>è¿™é‡Œé¢éšå«ç€ä¸€å±‚æ„æ€æ˜¯ï¼Œåœ¨æŠ›å‡ºOutofMemoryErrorä¹‹å‰ï¼Œé€šå¸¸åƒåœ¾æ”¶é›†å™¨ä¼šè¢«è§¦å‘ï¼Œå°½å…¶æ‰€èƒ½å»æ¸…ç†å‡ºç©ºé—´ã€‚</p><ul><li>ä¾‹å¦‚ï¼šåœ¨å¼•ç”¨æœºåˆ¶åˆ†æä¸­ï¼Œæ¶‰åŠåˆ°JVMä¼šå»å°è¯•<strong>å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡</strong>ç­‰ã€‚</li><li>åœ¨java.nio.Bits.reserveMemory()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬èƒ½æ¸…æ¥šçš„çœ‹åˆ°ï¼ŒSystem.gc()ä¼šè¢«è°ƒç”¨ï¼Œä»¥æ¸…ç†ç©ºé—´ã€‚</li></ul></li><li><p>å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šè¢«è§¦å‘çš„</p><ul><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å»åˆ†é…ä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œç±»ä¼¼ä¸€ä¸ªè¶…å¤§æ•°ç»„è¶…è¿‡å †çš„æœ€å¤§å€¼ï¼ŒJVMå¯ä»¥åˆ¤æ–­å‡ºåƒåœ¾æ”¶é›†å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥æŠ›å‡ºOutofMemoryErrorã€‚</li></ul></li></ol><h3 id="å†…å­˜æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#å†…å­˜æ³„æ¼" aria-hidden="true">#</a> å†…å­˜æ³„æ¼</h3><ol><li><p>ä¹Ÿç§°ä½œâ€œå­˜å‚¨æ¸—æ¼â€ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œ<strong>åªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯GCåˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚</strong></p></li><li><p>ä½†å®é™…æƒ…å†µå¾ˆå¤šæ—¶å€™ä¸€äº›ä¸å¤ªå¥½çš„å®è·µï¼ˆæˆ–ç–å¿½ï¼‰ä¼šå¯¼è‡´å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¾ˆé•¿ç”šè‡³å¯¼è‡´OOMï¼Œä¹Ÿå¯ä»¥å«åšå®½æ³›æ„ä¹‰ä¸Šçš„â€œå†…å­˜æ³„æ¼â€ã€‚</p></li><li><p>å°½ç®¡å†…å­˜æ³„æ¼å¹¶ä¸ä¼šç«‹åˆ»å¼•èµ·ç¨‹åºå´©æºƒï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œç¨‹åºä¸­çš„å¯ç”¨å†…å­˜å°±ä¼šè¢«é€æ­¥èš•é£Ÿï¼Œç›´è‡³è€—å°½æ‰€æœ‰å†…å­˜ï¼Œæœ€ç»ˆå‡ºç°OutofMemoryå¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p></li><li><p>æ³¨æ„ï¼Œè¿™é‡Œçš„å­˜å‚¨ç©ºé—´å¹¶ä¸æ˜¯æŒ‡ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯æŒ‡è™šæ‹Ÿå†…å­˜å¤§å°ï¼Œè¿™ä¸ªè™šæ‹Ÿå†…å­˜å¤§å°å–å†³äºç£ç›˜äº¤æ¢åŒºè®¾å®šçš„å¤§å°ã€‚</p></li></ol><p><strong>å†…å­˜æ³„éœ²å®˜æ–¹ä¾‹å­</strong></p><p>å·¦è¾¹çš„å›¾ï¼šJavaä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œæœ€ä¸Šé¢çš„æ•°æ®ä¸å¯è¾¾ï¼Œå°±æ˜¯éœ€è¦è¢«å›æ”¶çš„å¯¹è±¡ã€‚</p><p>å³è¾¹çš„å›¾ï¼šåæœŸæœ‰ä¸€äº›å¯¹è±¡ä¸ç”¨äº†ï¼ŒæŒ‰é“ç†åº”è¯¥æ–­å¼€å¼•ç”¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é“¾æ²¡æœ‰æ–­å¼€ï¼ˆå›¾ç¤ºä¸­çš„Forgotten Reference Memory Leakï¼‰ï¼Œä»è€Œå¯¼è‡´æ²¡æœ‰åŠæ³•è¢«å›æ”¶ã€‚</p><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0006.png"><p><strong>å¸¸è§ä¾‹å­</strong></p><ol><li>å•ä¾‹æ¨¡å¼ <ul><li>å•ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç¨‹åºæ˜¯ä¸€æ ·é•¿çš„ï¼Œæ‰€ä»¥åœ¨å•ä¾‹ç¨‹åºä¸­ï¼Œå¦‚æœæŒæœ‰å¯¹å¤–éƒ¨å¯¹è±¡çš„å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ï¼Œåˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼çš„äº§ç”Ÿã€‚</li></ul></li><li>ä¸€äº›æä¾›close()çš„èµ„æºæœªå…³é—­å¯¼è‡´å†…å­˜æ³„æ¼ <ul><li>æ•°æ®åº“è¿æ¥ dataSourse.getConnection()ï¼Œç½‘ç»œè¿æ¥socketå’Œioè¿æ¥å¿…é¡»æ‰‹åŠ¨closeï¼Œå¦åˆ™æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ã€‚</li></ul></li></ol><h2 id="stop-the-world" tabindex="-1"><a class="header-anchor" href="#stop-the-world" aria-hidden="true">#</a> Stop the World</h2><ol><li><p>Stop-the-Worldï¼Œç®€ç§°STWï¼ŒæŒ‡çš„æ˜¯GCäº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿåº”ç”¨ç¨‹åºçš„åœé¡¿ã€‚<strong>åœé¡¿äº§ç”Ÿæ—¶æ•´ä¸ªåº”ç”¨ç¨‹åºçº¿ç¨‹éƒ½ä¼šè¢«æš‚åœï¼Œæ²¡æœ‰ä»»ä½•å“åº”</strong>ï¼Œæœ‰ç‚¹åƒå¡æ­»çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªåœé¡¿ç§°ä¸ºSTWã€‚</p></li><li><p>å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­æšä¸¾æ ¹èŠ‚ç‚¹ï¼ˆGC Rootsï¼‰ä¼šå¯¼è‡´æ‰€æœ‰Javaæ‰§è¡Œçº¿ç¨‹åœé¡¿ï¼Œä¸ºä»€ä¹ˆéœ€è¦åœé¡¿æ‰€æœ‰ Java æ‰§è¡Œçº¿ç¨‹å‘¢ï¼Ÿ</p><ul><li><p>åˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œ</p></li><li><p>ä¸€è‡´æ€§æŒ‡æ•´ä¸ªåˆ†ææœŸé—´æ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Š</p></li><li><p><strong>å¦‚æœå‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœçš„å‡†ç¡®æ€§æ— æ³•ä¿è¯</strong></p></li></ul></li><li><p>è¢«STWä¸­æ–­çš„åº”ç”¨ç¨‹åºçº¿ç¨‹ä¼šåœ¨å®ŒæˆGCä¹‹åæ¢å¤ï¼Œé¢‘ç¹ä¸­æ–­ä¼šè®©ç”¨æˆ·æ„Ÿè§‰åƒæ˜¯ç½‘é€Ÿä¸å¿«é€ æˆç”µå½±å¡å¸¦ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‡å°‘STWçš„å‘ç”Ÿã€‚</p></li><li><p>STWäº‹ä»¶å’Œé‡‡ç”¨å“ªæ¬¾GCæ— å…³ï¼Œæ‰€æœ‰çš„GCéƒ½æœ‰è¿™ä¸ªäº‹ä»¶ã€‚</p></li><li><p>å“ªæ€•æ˜¯G1ä¹Ÿä¸èƒ½å®Œå…¨é¿å…Stop-the-worldæƒ…å†µå‘ç”Ÿï¼Œåªèƒ½è¯´åƒåœ¾å›æ”¶å™¨è¶Šæ¥è¶Šä¼˜ç§€ï¼Œå›æ”¶æ•ˆç‡è¶Šæ¥è¶Šé«˜ï¼Œå°½å¯èƒ½åœ°ç¼©çŸ­äº†æš‚åœæ—¶é—´ã€‚</p></li><li><p>STWæ˜¯JVMåœ¨<strong>åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆ</strong>çš„ã€‚åœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹ï¼ŒæŠŠç”¨æˆ·æ­£å¸¸çš„å·¥ä½œçº¿ç¨‹å…¨éƒ¨åœæ‰ã€‚</p></li><li><p>å¼€å‘ä¸­ä¸è¦ç”¨System.gc() ï¼Œè¿™ä¼šå¯¼è‡´Stop-the-Worldçš„å‘ç”Ÿã€‚</p></li></ol><h3 id="ä»£ç æ„Ÿå—-stop-the-world" tabindex="-1"><a class="header-anchor" href="#ä»£ç æ„Ÿå—-stop-the-world" aria-hidden="true">#</a> ä»£ç æ„Ÿå— Stop the World</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopTheWorldDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WorkThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">if</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        list<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¼šè§¦å‘full gcï¼Œè¿›è€Œä¼šå‡ºç°STWäº‹ä»¶</span>
                     
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">PrintThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// æ¯ç§’æ‰“å°æ—¶é—´ä¿¡æ¯</span>
                    <span class="token keyword">long</span> t <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> t <span class="token operator">%</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WorkThread</span> w <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WorkThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintThread</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³é—­å·¥ä½œçº¿ç¨‹ w ï¼Œè§‚å¯Ÿè¾“å‡ºï¼šå½“å‰æ—¶é—´é—´éš”ä¸ä¸Šæ¬¡æ—¶é—´é—´éš”<strong>åŸºæœ¬</strong>æ˜¯æ¯éš”1ç§’æ‰“å°ä¸€æ¬¡</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">0.1</span>
<span class="token number">1.1</span>
<span class="token number">2.2</span>
<span class="token number">3.2</span>
<span class="token number">4.3</span>
<span class="token number">5.3</span>
<span class="token number">6.3</span>
<span class="token number">7.3</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼€å¯å·¥ä½œçº¿ç¨‹ w ï¼Œè§‚å¯Ÿæ‰“å°è¾“å‡ºï¼šå½“å‰æ—¶é—´é—´éš”ä¸ä¸Šæ¬¡æ—¶é—´é—´éš”ç›¸å·® 1.3s ï¼Œå¯ä»¥æ˜æ˜¾æ„Ÿå—åˆ° Stop the World çš„å­˜åœ¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">0.1</span>
<span class="token number">1.4</span>
<span class="token number">2.7</span>
<span class="token number">3.8</span>
<span class="token number">4.12</span>
<span class="token number">5.13</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘" aria-hidden="true">#</a> åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘</h2><h3 id="å¹¶å‘çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘çš„æ¦‚å¿µ" aria-hidden="true">#</a> å¹¶å‘çš„æ¦‚å¿µ</h3><ol><li><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ˜¯æŒ‡<strong>ä¸€ä¸ªæ—¶é—´æ®µ</strong>ä¸­æœ‰å‡ ä¸ªç¨‹åºéƒ½å¤„äºå·²å¯åŠ¨è¿è¡Œåˆ°è¿è¡Œå®Œæ¯•ä¹‹é—´ï¼Œä¸”è¿™å‡ ä¸ªç¨‹åºéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå¤„ç†å™¨ä¸Šè¿è¡Œ</p></li><li><p>å¹¶å‘ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œåŒæ—¶è¿›è¡Œâ€ï¼Œåªæ˜¯CPUæŠŠä¸€ä¸ªæ—¶é—´æ®µåˆ’åˆ†æˆå‡ ä¸ªæ—¶é—´ç‰‡æ®µï¼ˆæ—¶é—´åŒºé—´ï¼‰ï¼Œç„¶ååœ¨è¿™å‡ ä¸ªæ—¶é—´åŒºé—´ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚ç”±äºCPUå¤„ç†çš„é€Ÿåº¦éå¸¸å¿«ï¼Œåªè¦æ—¶é—´é—´éš”å¤„ç†å¾—å½“ï¼Œå³å¯è®©ç”¨æˆ·æ„Ÿè§‰æ˜¯å¤šä¸ªåº”ç”¨ç¨‹åºåŒæ—¶åœ¨è¿›è¡Œ</p></li></ol><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0007.png"><h3 id="å¹¶è¡Œçš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#å¹¶è¡Œçš„æ¦‚å¿µ" aria-hidden="true">#</a> å¹¶è¡Œçš„æ¦‚å¿µ</h3><ol><li><p>å½“ç³»ç»Ÿæœ‰ä¸€ä¸ªä»¥ä¸ŠCPUæ—¶ï¼Œå½“ä¸€ä¸ªCPUæ‰§è¡Œä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ªCPUå¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸¤ä¸ªè¿›ç¨‹äº’ä¸æŠ¢å CPUèµ„æºï¼Œå¯ä»¥<strong>åŒæ—¶</strong>è¿›è¡Œï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶è¡Œï¼ˆParallelï¼‰</p></li><li><p>å…¶å®å†³å®šå¹¶è¡Œçš„å› ç´ ä¸æ˜¯CPUçš„æ•°é‡ï¼Œè€Œæ˜¯CPUçš„æ ¸å¿ƒæ•°é‡ï¼Œæ¯”å¦‚ä¸€ä¸ªCPUå¤šä¸ªæ ¸ä¹Ÿå¯ä»¥å¹¶è¡Œ</p></li><li><p>é€‚åˆç§‘å­¦è®¡ç®—ï¼Œåå°å¤„ç†ç­‰å¼±äº¤äº’åœºæ™¯</p></li></ol><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0008.png"><blockquote><p><strong>å¹¶å‘ä¸å¹¶è¡Œçš„å¯¹æ¯”</strong></p></blockquote><ol><li>å¹¶å‘ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªäº‹æƒ…ï¼Œåœ¨åŒä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿäº†ã€‚</li><li>å¹¶è¡Œï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªäº‹æƒ…ï¼Œåœ¨åŒä¸€æ—¶é—´ç‚¹ä¸Šï¼ˆæˆ–è€…è¯´åŒä¸€æ—¶åˆ»ï¼‰åŒæ—¶å‘ç”Ÿäº†ã€‚</li><li>å¹¶å‘çš„å¤šä¸ªä»»åŠ¡ä¹‹é—´æ˜¯äº’ç›¸æŠ¢å èµ„æºçš„ã€‚å¹¶è¡Œçš„å¤šä¸ªä»»åŠ¡ä¹‹é—´æ˜¯ä¸äº’ç›¸æŠ¢å èµ„æºçš„ã€‚</li><li>åªæœ‰åœ¨å¤šCPUæˆ–è€…ä¸€ä¸ªCPUå¤šæ ¸çš„æƒ…å†µä¸­ï¼Œæ‰ä¼šå‘ç”Ÿå¹¶è¡Œã€‚å¦åˆ™ï¼Œçœ‹ä¼¼åŒæ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼Œå…¶å®éƒ½æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚</li></ol><h3 id="åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ" aria-hidden="true">#</a> åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ</h3><ol><li>å¹¶è¡Œï¼ˆParallelï¼‰ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€ã€‚ <ul><li>å¦‚ParNewã€Parallel Scavengeã€Parallel Old</li></ul></li><li>ä¸²è¡Œï¼ˆSerialï¼‰ <ul><li>ç›¸è¾ƒäºå¹¶è¡Œçš„æ¦‚å¿µï¼Œå•çº¿ç¨‹æ‰§è¡Œã€‚</li><li>å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåˆ™ç¨‹åºæš‚åœï¼Œå¯åŠ¨JVMåƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆå•çº¿ç¨‹ï¼‰</li></ul></li></ol><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0009.png"><p>å¹¶å‘å’Œå¹¶è¡Œï¼Œåœ¨è°ˆè®ºåƒåœ¾æ”¶é›†å™¨çš„ä¸Šä¸‹æ–‡è¯­å¢ƒä¸­ï¼Œå®ƒä»¬å¯ä»¥è§£é‡Šå¦‚ä¸‹ï¼š</p><ol><li>å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡<strong>ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œ</strong>ï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ä¸ä¼šåœé¡¿ç”¨æˆ·ç¨‹åºçš„è¿è¡Œã€‚ <ul><li>æ¯”å¦‚ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºçº¿ç¨‹è¿è¡Œäºå¦ä¸€ä¸ªCPUä¸Šï¼›</li></ul></li><li>å…¸å‹åƒåœ¾å›æ”¶å™¨ï¼šCMSã€G1</li></ol><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0010.png"><h2 id="hotspotçš„ç®—æ³•å®ç°ç»†èŠ‚" tabindex="-1"><a class="header-anchor" href="#hotspotçš„ç®—æ³•å®ç°ç»†èŠ‚" aria-hidden="true">#</a> HotSpotçš„ç®—æ³•å®ç°ç»†èŠ‚</h2><h3 id="æ ¹èŠ‚ç‚¹æšä¸¾" tabindex="-1"><a class="header-anchor" href="#æ ¹èŠ‚ç‚¹æšä¸¾" aria-hidden="true">#</a> æ ¹èŠ‚ç‚¹æšä¸¾</h3><p>1ã€å›ºå®šå¯ä½œä¸ºGC Rootsçš„èŠ‚ç‚¹ä¸»è¦åœ¨å…¨å±€æ€§çš„å¼•ç”¨ï¼ˆä¾‹å¦‚å¸¸é‡æˆ–ç±»é™æ€å±æ€§ï¼‰ä¸æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­ï¼Œå°½ç®¡ç›®æ ‡æ˜ç¡®ï¼Œä½†æŸ¥æ‰¾è¿‡ç¨‹è¦åšåˆ°é«˜æ•ˆå¹¶éä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œç°åœ¨Javaåº”ç”¨è¶Šåšè¶Šåºå¤§ï¼Œå…‰æ˜¯æ–¹æ³•åŒºçš„å¤§å°å°±å¸¸æœ‰æ•°ç™¾ä¸Šåƒå…†ï¼Œé‡Œé¢çš„ç±»ã€å¸¸é‡ç­‰æ›´æ˜¯æ’æ²³æ²™æ•°ï¼Œè‹¥è¦é€ä¸ªæ£€æŸ¥ä»¥è¿™é‡Œä¸ºèµ·æºçš„å¼•ç”¨è‚¯å®šå¾—æ¶ˆè€—ä¸å°‘æ—¶é—´ã€‚</p><p>2ã€è¿„ä»Šä¸ºæ­¢ï¼Œ<strong>æ‰€æœ‰æ”¶é›†å™¨åœ¨æ ¹èŠ‚ç‚¹æšä¸¾è¿™ä¸€æ­¥éª¤æ—¶éƒ½æ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹çš„</strong>ï¼Œå› æ­¤æ¯«æ— ç–‘é—®æ ¹èŠ‚ç‚¹ æšä¸¾ä¸ä¹‹å‰æåŠçš„æ•´ç†å†…å­˜ç¢ç‰‡ä¸€æ ·ä¼šé¢ä¸´ç›¸ä¼¼çš„â€œStop The Worldâ€çš„å›°æ‰°ã€‚ç°åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•è€—æ—¶ æœ€é•¿çš„æŸ¥æ‰¾å¼•ç”¨é“¾çš„è¿‡ç¨‹å·²ç»å¯ä»¥åšåˆ°ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘ï¼Œ<strong>ä½†æ ¹èŠ‚ç‚¹æšä¸¾å§‹ç»ˆè¿˜ æ˜¯å¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­æ‰å¾—ä»¥è¿›è¡Œ</strong>â€”â€”è¿™é‡Œâ€œä¸€è‡´æ€§â€çš„æ„æ€æ˜¯æ•´ä¸ªæšä¸¾æœŸé—´æ‰§è¡Œå­ç³»ç»Ÿ çœ‹èµ·æ¥å°±åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œä¸ä¼šå‡ºç°åˆ†æè¿‡ç¨‹ä¸­ï¼Œæ ¹èŠ‚ç‚¹é›†åˆçš„å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ– çš„æƒ…å†µï¼Œè‹¥è¿™ç‚¹ä¸èƒ½æ»¡è¶³çš„è¯ï¼Œåˆ†æç»“æœå‡†ç¡®æ€§ä¹Ÿå°±æ— æ³•ä¿è¯ã€‚è¿™æ˜¯å¯¼è‡´åƒåœ¾æ”¶é›†è¿‡ç¨‹å¿…é¡»åœé¡¿æ‰€æœ‰ ç”¨æˆ·çº¿ç¨‹çš„å…¶ä¸­ä¸€ä¸ªé‡è¦åŸå› ï¼Œå³ä½¿æ˜¯å·ç§°åœé¡¿æ—¶é—´å¯æ§ï¼Œæˆ–è€…ï¼ˆå‡ ä¹ï¼‰ä¸ä¼šå‘ç”Ÿåœé¡¿çš„CMSã€G1ã€ ZGCç­‰æ”¶é›†å™¨ï¼Œæšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„ã€‚</p><p>3ã€ç”±äºç›®å‰ä¸»æµJavaè™šæ‹Ÿæœºä½¿ç”¨çš„éƒ½æ˜¯<strong>å‡†ç¡®å¼åƒåœ¾æ”¶é›†</strong>ï¼Œæ‰€ä»¥å½“ç”¨æˆ·çº¿ç¨‹åœé¡¿ä¸‹æ¥ä¹‹åï¼Œå…¶å®å¹¶ä¸éœ€è¦ä¸€ä¸ªä¸æ¼åœ°æ£€æŸ¥å®Œæ‰€æœ‰ æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå…¨å±€çš„å¼•ç”¨ä½ç½®ï¼Œè™šæ‹Ÿæœºåº”å½“æ˜¯æœ‰åŠæ³•ç›´æ¥å¾—åˆ°å“ªäº›åœ°æ–¹å­˜æ”¾ç€å¯¹è±¡å¼•ç”¨çš„ã€‚åœ¨HotSpot çš„è§£å†³æ–¹æ¡ˆé‡Œï¼Œæ˜¯ä½¿ç”¨ä¸€ç»„ç§°ä¸º<strong>OopMapçš„æ•°æ®ç»“æ„</strong>æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚ä¸€æ—¦ç±»åŠ è½½åŠ¨ä½œå®Œæˆçš„æ—¶å€™ï¼Œ HotSpotå°±ä¼šæŠŠå¯¹è±¡å†…ä»€ä¹ˆåç§»é‡ä¸Šæ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®è®¡ç®—å‡ºæ¥ï¼Œåœ¨å³æ—¶ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¹Ÿ ä¼šåœ¨ç‰¹å®šçš„ä½ç½®è®°å½•ä¸‹æ ˆé‡Œå’Œå¯„å­˜å™¨é‡Œå“ªäº›ä½ç½®æ˜¯å¼•ç”¨ã€‚è¿™æ ·æ”¶é›†å™¨åœ¨æ‰«ææ—¶å°±å¯ä»¥ç›´æ¥å¾—çŸ¥è¿™äº›ä¿¡ æ¯äº†ï¼Œ<strong>å¹¶ä¸éœ€è¦çœŸæ­£ä¸€ä¸ªä¸æ¼åœ°ä»æ–¹æ³•åŒºç­‰GC Rootså¼€å§‹æŸ¥æ‰¾</strong>ã€‚</p><p>4ã€Exact VMå› å®ƒä½¿ç”¨<strong>å‡†ç¡®å¼å†…å­˜ç®¡ç†</strong>ï¼ˆExact Memory Managementï¼Œä¹Ÿå¯ä»¥å«Non-Con- servative/Accurate Memory Managementï¼‰è€Œå¾—åã€‚å‡†ç¡®å¼å†…å­˜ç®¡ç†æ˜¯æŒ‡è™šæ‹Ÿæœºå¯ä»¥çŸ¥é“å†…å­˜ä¸­æŸä¸ªä½ ç½®çš„æ•°æ®å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ã€‚è­¬å¦‚å†…å­˜ä¸­æœ‰ä¸€ä¸ª32bitçš„æ•´æ•°123456ï¼Œè™šæ‹Ÿæœºå°†æœ‰èƒ½åŠ›åˆ†è¾¨å‡ºå®ƒåˆ°åº•æ˜¯ä¸€ ä¸ªæŒ‡å‘äº†123456çš„å†…å­˜åœ°å€çš„å¼•ç”¨ç±»å‹è¿˜æ˜¯ä¸€ä¸ªæ•°å€¼ä¸º123456çš„æ•´æ•°ï¼Œå‡†ç¡®åˆ†è¾¨å‡ºå“ªäº›å†…å­˜æ˜¯å¼•ç”¨ç±» å‹ï¼Œè¿™ä¹Ÿæ˜¯åœ¨åƒåœ¾æ”¶é›†æ—¶å‡†ç¡®åˆ¤æ–­å †ä¸Šçš„æ•°æ®æ˜¯å¦è¿˜å¯èƒ½è¢«ä½¿ç”¨çš„å‰æã€‚ã€<strong>è¿™ä¸ªä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œäº†è§£ä¸€ä¸‹å³å¯</strong>ã€‘</p><blockquote><p>å¸¸è€ƒé¢è¯•ï¼š<strong>åœ¨OopMapçš„ååŠ©ä¸‹ï¼ŒHotSpotå¯ä»¥å¿«é€Ÿå‡†ç¡®åœ°å®ŒæˆGC Rootsæšä¸¾</strong></p></blockquote><h3 id="å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ" aria-hidden="true">#</a> å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ</h3><p><strong>å®‰å…¨ç‚¹ï¼ˆSafepointï¼‰</strong></p><ol><li><p>ç¨‹åºæ‰§è¡Œæ—¶å¹¶éåœ¨æ‰€æœ‰åœ°æ–¹éƒ½èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œåªæœ‰åœ¨ç‰¹å®šçš„ä½ç½®æ‰èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œè¿™äº›ä½ç½®ç§°ä¸ºâ€œå®‰å…¨ç‚¹ï¼ˆSafepointï¼‰â€ã€‚</p></li><li><p>Safe Pointçš„é€‰æ‹©å¾ˆé‡è¦ï¼Œ<strong>å¦‚æœå¤ªå°‘å¯èƒ½å¯¼è‡´GCç­‰å¾…çš„æ—¶é—´å¤ªé•¿ï¼Œå¦‚æœå¤ªé¢‘ç¹å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶çš„æ€§èƒ½é—®é¢˜</strong>ã€‚å¤§éƒ¨åˆ†æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´éƒ½éå¸¸çŸ­æš‚ï¼Œé€šå¸¸ä¼šæ ¹æ®â€œ<strong>æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾</strong>â€ä¸ºæ ‡å‡†ã€‚æ¯”å¦‚ï¼šé€‰æ‹©ä¸€äº›æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æŒ‡ä»¤ä½œä¸ºSafe Pointï¼Œ<strong>å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬å’Œå¼‚å¸¸è·³è½¬ç­‰</strong>ã€‚</p></li></ol><p><strong>å¦‚ä½•åœ¨GCå‘ç”Ÿæ—¶ï¼Œæ£€æŸ¥æ‰€æœ‰çº¿ç¨‹éƒ½è·‘åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹åœé¡¿ä¸‹æ¥å‘¢ï¼Ÿ</strong></p><ol><li>æŠ¢å…ˆå¼ä¸­æ–­ï¼šï¼ˆç›®å‰æ²¡æœ‰è™šæ‹Ÿæœºé‡‡ç”¨äº†ï¼‰é¦–å…ˆä¸­æ–­æ‰€æœ‰çº¿ç¨‹ã€‚å¦‚æœè¿˜æœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ã€‚</li><li>ä¸»åŠ¨å¼ä¸­æ–­ï¼šè®¾ç½®ä¸€ä¸ªä¸­æ–­æ ‡å¿—ï¼Œå„ä¸ªçº¿ç¨‹è¿è¡Œåˆ°Safe Pointçš„æ—¶å€™<strong>ä¸»åŠ¨è½®è¯¢</strong>è¿™ä¸ªæ ‡å¿—ï¼Œå¦‚æœä¸­æ–­æ ‡å¿—ä¸ºçœŸï¼Œåˆ™å°†è‡ªå·±è¿›è¡Œä¸­æ–­æŒ‚èµ·ã€‚</li></ol><p><strong>å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰</strong></p><ol><li>Safepoint æœºåˆ¶ä¿è¯äº†ç¨‹åºæ‰§è¡Œæ—¶ï¼Œåœ¨ä¸å¤ªé•¿çš„æ—¶é—´å†…å°±ä¼šé‡åˆ°å¯è¿›å…¥GCçš„Safepointã€‚ä½†æ˜¯ï¼Œç¨‹åºâ€œä¸æ‰§è¡Œâ€çš„æ—¶å€™å‘¢ï¼Ÿ</li><li>ä¾‹å¦‚çº¿ç¨‹å¤„äºSleepçŠ¶æ€æˆ–Blocked çŠ¶æ€ï¼Œè¿™æ—¶å€™çº¿ç¨‹æ— æ³•å“åº”JVMçš„ä¸­æ–­è¯·æ±‚ï¼Œâ€œèµ°â€åˆ°å®‰å…¨ç‚¹å»ä¸­æ–­æŒ‚èµ·ï¼ŒJVMä¹Ÿä¸å¤ªå¯èƒ½ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå°±éœ€è¦å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰æ¥è§£å†³ã€‚</li><li><strong>å®‰å…¨åŒºåŸŸæ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç ç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä¸­çš„ä»»ä½•ä½ç½®å¼€å§‹GCéƒ½æ˜¯å®‰å…¨çš„</strong>ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠSafe Regionçœ‹åšæ˜¯è¢«æ‰©å±•äº†çš„Safepointã€‚</li></ol><p><strong>å®‰å…¨åŒºåŸŸçš„æ‰§è¡Œæµç¨‹</strong></p><ol><li>å½“çº¿ç¨‹è¿è¡Œåˆ°Safe Regionçš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†å·²ç»è¿›å…¥äº†Safe Regionï¼Œå¦‚æœè¿™æ®µæ—¶é—´å†…å‘ç”ŸGCï¼ŒJVMä¼šå¿½ç•¥æ ‡è¯†ä¸ºSafe RegionçŠ¶æ€çš„çº¿ç¨‹</li><li>å½“çº¿ç¨‹å³å°†ç¦»å¼€Safe Regionæ—¶ï¼Œä¼šæ£€æŸ¥JVMæ˜¯å¦å·²ç»å®Œæˆæ ¹èŠ‚ç‚¹æšä¸¾ï¼ˆå³GC Rootsçš„æšä¸¾ï¼‰ï¼Œå¦‚æœå®Œæˆäº†ï¼Œåˆ™ç»§ç»­è¿è¡Œï¼Œå¦åˆ™çº¿ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€Safe Regionçš„ä¿¡å·ä¸ºæ­¢ï¼›</li></ol><h3 id="è®°å¿†é›†ä¸å¡è¡¨" tabindex="-1"><a class="header-anchor" href="#è®°å¿†é›†ä¸å¡è¡¨" aria-hidden="true">#</a> è®°å¿†é›†ä¸å¡è¡¨</h3><h4 id="ä»€ä¹ˆæ˜¯è·¨ä»£å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯è·¨ä»£å¼•ç”¨" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯è·¨ä»£å¼•ç”¨ï¼Ÿ</h4><p>1ã€ä¸€èˆ¬çš„åƒåœ¾å›æ”¶ç®—æ³•è‡³å°‘ä¼šåˆ’åˆ†å‡ºä¸¤ä¸ªå¹´ä»£ï¼Œå¹´è½»ä»£å’Œè€å¹´ä»£ã€‚ä½†æ˜¯å•çº¯çš„åˆ†ä»£ç†è®ºåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™å­˜åœ¨ä¸€ä¸ªå·¨å¤§çš„ç¼ºé™·ï¼šä¸ºäº†æ‰¾åˆ°å¹´è½»ä»£ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œå´ä¸å¾—ä¸éå†æ•´ä¸ªè€å¹´ä»£ï¼Œåè¿‡æ¥ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0011.png"><p>2ã€å¦‚æœæˆ‘ä»¬ä»å¹´è½»ä»£å¼€å§‹éå†ï¼Œé‚£ä¹ˆå¯ä»¥æ–­å®šN, S, P, Qéƒ½æ˜¯å­˜æ´»å¯¹è±¡ã€‚ä½†æ˜¯ï¼ŒVå´ä¸ä¼šè¢«è®¤ä¸ºæ˜¯å­˜æ´»å¯¹è±¡ï¼Œå…¶å æ®çš„å†…å­˜ä¼šè¢«å›æ”¶äº†ã€‚è¿™å°±æ˜¯ä¸€ä¸ªæƒŠå¤©çš„å¤§æ¼æ´ï¼å› ä¸ºUæœ¬èº«æ˜¯è€å¹´ä»£å¯¹è±¡ï¼Œè€Œä¸”æœ‰å¤–éƒ¨å¼•ç”¨æŒ‡å‘å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´Uæ˜¯å­˜æ´»å¯¹è±¡ï¼Œè€ŒUæŒ‡å‘äº†Vï¼Œä¹Ÿå°±æ˜¯è¯´Vä¹Ÿåº”è¯¥æ˜¯å­˜æ´»å¯¹è±¡æ‰æ˜¯ï¼è€Œè¿™éƒ½æ˜¯å› ä¸ºæˆ‘ä»¬åªéå†å¹´è½»ä»£å¯¹è±¡ï¼</p><p>3ã€æ‰€ä»¥ï¼Œä¸ºäº†è§£å†³è¿™ç§è·¨ä»£å¼•ç”¨çš„é—®é¢˜ï¼Œæœ€ç¬¨çš„åŠæ³•å°±æ˜¯éå†è€å¹´ä»£çš„å¯¹è±¡ï¼Œæ‰¾å‡ºè¿™äº›è·¨ä»£å¼•ç”¨æ¥ã€‚è¿™ç§æ–¹æ¡ˆå­˜åœ¨æå¤§çš„æ€§èƒ½æµªè´¹ã€‚å› ä¸ºä»ä¸¤ä¸ªåˆ†ä»£å‡è¯´é‡Œé¢ï¼Œå…¶å®éšå«äº†ä¸€ä¸ªæ¨è®ºï¼šè·¨ä»£å¼•ç”¨æ˜¯æå°‘çš„ã€‚ä¹Ÿå°±æ˜¯ä¸ºäº†æ‰¾å‡ºé‚£ä¹ˆä¸€ç‚¹ç‚¹è·¨ä»£å¼•ç”¨ï¼Œæˆ‘ä»¬å´å¾—éå†æ•´ä¸ªè€å¹´ä»£ï¼ä»ä¸Šå›¾æ¥è¯´ï¼Œå¾ˆæ˜¾ç„¶çš„æ˜¯ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸å¿…éå†Rã€‚</p><p>4ã€å› æ­¤ï¼Œä¸ºäº†é¿å…è¿™ç§éå†è€å¹´ä»£çš„æ€§èƒ½å¼€é”€ï¼Œé€šå¸¸çš„åˆ†ä»£åƒåœ¾å›æ”¶å™¨ä¼šå¼•å…¥ä¸€ç§ç§°ä¸º<strong>è®°å¿†é›†</strong>çš„æŠ€æœ¯ã€‚<strong>ç®€å•æ¥è¯´ï¼Œè®°å¿†é›†å°±æ˜¯ç”¨æ¥è®°å½•è·¨ä»£å¼•ç”¨çš„è¡¨ã€‚</strong></p><h4 id="è®°å¿†é›†ä¸å¡è¡¨-1" tabindex="-1"><a class="header-anchor" href="#è®°å¿†é›†ä¸å¡è¡¨-1" aria-hidden="true">#</a> è®°å¿†é›†ä¸å¡è¡¨</h4><p>1ã€ä¸ºè§£å†³å¯¹è±¡è·¨ä»£å¼•ç”¨æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£ä¸­å»º ç«‹äº†åä¸º<strong>è®°å¿†é›†ï¼ˆRemembered Setï¼‰çš„æ•°æ®ç»“æ„</strong>ï¼Œç”¨ä»¥é¿å…æŠŠæ•´ä¸ªè€å¹´ä»£åŠ è¿›GC Rootsæ‰«æèŒƒå›´ã€‚äº‹å®ä¸Šå¹¶ä¸åªæ˜¯æ–°ç”Ÿä»£ã€è€å¹´ä»£ä¹‹é—´æ‰æœ‰è·¨ä»£å¼•ç”¨çš„é—®é¢˜ï¼Œæ‰€æœ‰æ¶‰åŠéƒ¨åˆ†åŒºåŸŸæ”¶é›†ï¼ˆPartial GCï¼‰è¡Œä¸ºçš„ åƒåœ¾æ”¶é›†å™¨ï¼Œå…¸å‹çš„å¦‚G1ã€ZGCå’ŒShenandoahæ”¶é›†å™¨ï¼Œéƒ½ä¼šé¢ä¸´ç›¸åŒçš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦è¿›ä¸€æ­¥ ç†æ¸…è®°å¿†é›†çš„åŸç†å’Œå®ç°æ–¹å¼ï¼Œä»¥ä¾¿åœ¨åç»­ç« èŠ‚é‡Œä»‹ç»å‡ æ¬¾æœ€æ–°çš„æ”¶é›†å™¨ç›¸å…³çŸ¥è¯†æ—¶èƒ½æ›´å¥½åœ°ç†è§£ã€‚</p><p>2ã€è®°å¿†é›†æ˜¯ä¸€ç§ç”¨äºè®°å½•<strong>ä»éæ”¶é›†åŒºåŸŸæŒ‡å‘æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆé›†åˆçš„æŠ½è±¡æ•°æ®ç»“æ„</strong>ã€‚å¦‚æœæˆ‘ä»¬ä¸è€ƒè™‘æ•ˆç‡å’Œæˆæœ¬çš„è¯ï¼Œæœ€ç®€å•çš„å®ç°å¯ä»¥ç”¨éæ”¶é›†åŒºåŸŸä¸­æ‰€æœ‰å«è·¨ä»£å¼•ç”¨çš„å¯¹è±¡æ•°ç»„æ¥å®ç°è¿™ä¸ªæ•°æ®ç»“æ„ã€‚</p><blockquote><p>æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰è€å¹´ä»£ï¼ˆéæ”¶é›†åŒºåŸŸï¼‰å’Œå¹´è½»ä»£ï¼ˆæ”¶é›†åŒºåŸŸï¼‰çš„å¯¹è±¡ä¹‹é—´æœ‰ä¸€æ¡å¼•ç”¨é“¾</p></blockquote><p>3ã€è¿™ç§è®°å½•å…¨éƒ¨å«è·¨ä»£å¼•ç”¨å¯¹è±¡çš„å®ç°æ–¹æ¡ˆï¼Œæ— è®ºæ˜¯ç©ºé—´å ç”¨è¿˜æ˜¯ç»´æŠ¤æˆæœ¬éƒ½ç›¸å½“é«˜æ˜‚ã€‚è€Œåœ¨åƒåœ¾ æ”¶é›†çš„åœºæ™¯ä¸­ï¼Œæ”¶é›†å™¨åªéœ€è¦é€šè¿‡è®°å¿†é›†åˆ¤æ–­å‡ºæŸä¸€å—éæ”¶é›†åŒºåŸŸæ˜¯å¦å­˜åœ¨æœ‰æŒ‡å‘äº†æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆ å°±å¯ä»¥äº†ï¼Œå¹¶ä¸éœ€è¦äº†è§£è¿™äº›è·¨ä»£æŒ‡é’ˆçš„å…¨éƒ¨ç»†èŠ‚ã€‚é‚£è®¾è®¡è€…åœ¨å®ç°è®°å¿†é›†çš„æ—¶å€™ï¼Œä¾¿å¯ä»¥é€‰æ‹©æ›´ä¸º ç²—çŠ·çš„è®°å½•ç²’åº¦æ¥èŠ‚çœè®°å¿†é›†çš„å­˜å‚¨å’Œç»´æŠ¤æˆæœ¬ï¼Œä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›å¯ä¾›é€‰æ‹©ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©è¿™ä¸ªèŒƒ å›´ä»¥å¤–çš„ï¼‰çš„è®°å½•ç²¾åº¦ï¼š</p><ul><li>å­—é•¿ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€ä¸ªæœºå™¨å­—é•¿ï¼ˆå°±æ˜¯å¤„ç†å™¨çš„å¯»å€ä½æ•°ï¼Œå¦‚å¸¸è§çš„32ä½æˆ–64ä½ï¼Œè¿™ä¸ª ç²¾åº¦å†³å®šäº†æœºå™¨è®¿é—®ç‰©ç†å†…å­˜åœ°å€çš„æŒ‡é’ˆé•¿åº¦ï¼‰ï¼Œè¯¥å­—åŒ…å«è·¨ä»£æŒ‡é’ˆã€‚</li><li>å¯¹è±¡ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡é‡Œæœ‰å­—æ®µå«æœ‰è·¨ä»£æŒ‡é’ˆã€‚</li><li>å¡ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¯¥åŒºåŸŸå†…æœ‰å¯¹è±¡å«æœ‰è·¨ä»£æŒ‡é’ˆã€‚</li></ul><p>4ã€å…¶ä¸­ï¼Œç¬¬ä¸‰ç§â€œå¡ç²¾åº¦â€æ‰€æŒ‡çš„æ˜¯ç”¨ä¸€ç§ç§°ä¸ºâ€œå¡è¡¨â€ï¼ˆCard Tableï¼‰çš„æ–¹å¼å»å®ç°è®°å¿†é›†ï¼Œè¿™ä¹Ÿæ˜¯ ç›®å‰æœ€å¸¸ç”¨çš„ä¸€ç§è®°å¿†é›†å®ç°å½¢å¼ï¼Œä¸€äº›èµ„æ–™ä¸­ç”šè‡³ç›´æ¥æŠŠå®ƒå’Œè®°å¿†é›†æ··ä¸ºä¸€è°ˆã€‚å‰é¢å®šä¹‰ä¸­æåˆ°è®° å¿†é›†å…¶å®æ˜¯ä¸€ç§â€œæŠ½è±¡â€çš„æ•°æ®ç»“æ„ï¼ŒæŠ½è±¡çš„æ„æ€æ˜¯åªå®šä¹‰äº†è®°å¿†é›†çš„è¡Œä¸ºæ„å›¾ï¼Œå¹¶æ²¡æœ‰å®šä¹‰å…¶è¡Œä¸ºçš„ å…·ä½“å®ç°ã€‚å¡è¡¨å°±æ˜¯è®°å¿†é›†çš„ä¸€ç§å…·ä½“å®ç°ï¼Œå®ƒå®šä¹‰äº†è®°å¿†é›†çš„è®°å½•ç²¾åº¦ã€ä¸å †å†…å­˜çš„æ˜ å°„å…³ç³»ç­‰ã€‚ å…³äºå¡è¡¨ä¸è®°å¿†é›†çš„å…³ç³»ï¼Œè¯»è€…ä¸å¦¨æŒ‰ç…§Javaè¯­è¨€ä¸­HashMapä¸Mapçš„å…³ç³»æ¥ç±»æ¯”ç†è§£ã€‚ å¡è¡¨æœ€ç®€å•çš„å½¢å¼å¯ä»¥åªæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œè€ŒHotSpotè™šæ‹Ÿæœºç¡®å®ä¹Ÿæ˜¯è¿™æ ·åšçš„</p><blockquote><p>è¯»è€…åªéœ€è¦çŸ¥é“æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œé¢è¯•çš„æ—¶å€™èƒ½è¯´å‡ºæ¥ï¼Œå†ç»†è‡´ä¸€ç‚¹çš„å°±éœ€è¦çœ‹å‘¨å¿—æ˜è€å¸ˆçš„ç¬¬ä¸‰ç‰ˆä¹¦äº†</p></blockquote><h2 id="å†è°ˆå¼•ç”¨æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#å†è°ˆå¼•ç”¨æ¦‚è¿°" aria-hidden="true">#</a> å†è°ˆå¼•ç”¨æ¦‚è¿°</h2><ol><li><p>æˆ‘ä»¬å¸Œæœ›èƒ½æè¿°è¿™æ ·ä¸€ç±»å¯¹è±¡ï¼šå½“å†…å­˜ç©ºé—´è¿˜è¶³å¤Ÿæ—¶ï¼Œåˆ™èƒ½ä¿ç•™åœ¨å†…å­˜ä¸­ï¼›å¦‚æœå†…å­˜ç©ºé—´åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†åè¿˜æ˜¯å¾ˆç´§å¼ ï¼Œåˆ™å¯ä»¥æŠ›å¼ƒè¿™äº›å¯¹è±¡ã€‚</p></li><li><p>æ—¢åé—¨åˆéå¸¸é«˜é¢‘çš„é¢è¯•é¢˜ï¼šå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…·ä½“ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>åœ¨JDK1.2ç‰ˆä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºï¼š</p><ul><li>å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</li><li>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</li><li>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</li><li>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</li></ul></li><li><p>è¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚é™¤å¼ºå¼•ç”¨å¤–ï¼Œå…¶ä»–3ç§å¼•ç”¨å‡å¯ä»¥åœ¨java.lang.refåŒ…ä¸­æ‰¾åˆ°å®ƒä»¬çš„èº«å½±ã€‚å¦‚ä¸‹å›¾ï¼Œæ˜¾ç¤ºäº†è¿™3ç§å¼•ç”¨ç±»å‹å¯¹åº”çš„ç±»ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p></li></ol><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0012.png"><p>Referenceå­ç±»ä¸­åªæœ‰ç»ˆç»“å™¨å¼•ç”¨æ˜¯åŒ…å†…å¯è§çš„ï¼Œå…¶ä»–3ç§å¼•ç”¨ç±»å‹å‡ä¸ºpublicï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨</p><ol><li>å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ï¼šæœ€ä¼ ç»Ÿçš„â€œå¼•ç”¨â€çš„å®šä¹‰ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œå³ç±»ä¼¼â€œ<code>object obj=new Object()</code>â€è¿™ç§å¼•ç”¨å…³ç³»ã€‚æ— è®ºä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å®å¯æŠ¥OOMï¼Œä¹Ÿä¸ä¼šGCå¼ºå¼•ç”¨</li><li>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ï¼šåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—å…¥å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ã€‚å¦‚æœè¿™æ¬¡å›æ”¶åè¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</li><li>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ï¼šè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</li><li>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ï¼šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å¾—ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</li></ol><h2 id="å†è°ˆå¼•ç”¨-å¼ºå¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#å†è°ˆå¼•ç”¨-å¼ºå¼•ç”¨" aria-hidden="true">#</a> å†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨</h2><ol><li><p>åœ¨Javaç¨‹åºä¸­ï¼Œæœ€å¸¸è§çš„å¼•ç”¨ç±»å‹æ˜¯å¼ºå¼•ç”¨ï¼ˆæ™®é€šç³»ç»Ÿ99%ä»¥ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œ<strong>ä¹Ÿæ˜¯é»˜è®¤çš„å¼•ç”¨ç±»å‹</strong>ã€‚</p></li><li><p>å½“åœ¨Javaè¯­è¨€ä¸­ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å°±æˆä¸ºæŒ‡å‘è¯¥å¯¹è±¡çš„ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</p></li><li><p>**åªè¦å¼ºå¼•ç”¨çš„å¯¹è±¡æ˜¯å¯è§¦åŠçš„ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚**åªè¦å¼ºå¼•ç”¨çš„å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œjvmå®å¯æŠ¥OOMï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨ã€‚</p></li><li><p>å¯¹äºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å…³ç³»ï¼Œåªè¦è¶…è¿‡äº†å¼•ç”¨çš„ä½œç”¨åŸŸæˆ–è€…æ˜¾å¼åœ°å°†ç›¸åº”ï¼ˆå¼ºï¼‰å¼•ç”¨èµ‹å€¼ä¸ºnullï¼Œå°±æ˜¯å¯ä»¥å½“åšåƒåœ¾è¢«æ”¶é›†äº†ï¼Œå½“ç„¶å…·ä½“å›æ”¶æ—¶æœºè¿˜æ˜¯è¦çœ‹åƒåœ¾æ”¶é›†ç­–ç•¥ã€‚</p></li><li><p>ç›¸å¯¹çš„ï¼Œè½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨çš„å¯¹è±¡æ˜¯è½¯å¯è§¦åŠã€å¼±å¯è§¦åŠå’Œè™šå¯è§¦åŠçš„ï¼Œåœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œéƒ½æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚æ‰€ä»¥ï¼Œå¼ºå¼•ç”¨æ˜¯é€ æˆJavaå†…å­˜æ³„æ¼çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚</p></li></ol><p><strong>å¼ºå¼•ç”¨ä»£ç ä¸¾ä¾‹</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StrongReferenceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuffer</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello,å°šç¡…è°·&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuffer</span> str1 <span class="token operator">=</span> str<span class="token punctuation">;</span>

        str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Hello</span><span class="token punctuation">,</span>å°šç¡…è°·
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å±€éƒ¨å˜é‡stræŒ‡å‘stringBufferå®ä¾‹æ‰€åœ¨å †ç©ºé—´ï¼Œé€šè¿‡strå¯ä»¥æ“ä½œè¯¥å®ä¾‹ï¼Œé‚£ä¹ˆstrå°±æ˜¯stringBufferå®ä¾‹çš„å¼ºå¼•ç”¨å¯¹åº”å†…å­˜ç»“æ„ï¼š</p><p><code>StringBuffer str = new StringBuffer(&quot;hello,å°šç¡…è°·&quot;);</code></p><img src="https://npm.elemecdn.com/youthlql@1.0.8/JVM/chapter_011/0013.png"><p><strong>æ€»ç»“</strong></p><p>æœ¬ä¾‹ä¸­çš„ä¸¤ä¸ªå¼•ç”¨ï¼Œéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œå¼ºå¼•ç”¨å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>å¼ºå¼•ç”¨å¯ä»¥ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚</li><li>å¼ºå¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œè™šæ‹Ÿæœºå®æ„¿æŠ›å‡ºOOMå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨æ‰€æŒ‡å‘å¯¹è±¡ã€‚</li><li>å¼ºå¼•ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li></ol><h2 id="å†è°ˆå¼•ç”¨-è½¯å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#å†è°ˆå¼•ç”¨-è½¯å¼•ç”¨" aria-hidden="true">#</a> å†è°ˆå¼•ç”¨ï¼šè½¯å¼•ç”¨</h2><p><strong>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ï¼šå†…å­˜ä¸è¶³å³å›æ”¶</strong></p><ol><li><p>è½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†éå¿…éœ€çš„å¯¹è±¡ã€‚åªè¢«è½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ï¼Œå¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ç¬¬ä¸€æ¬¡å›æ”¶æ˜¯ä¸å¯è¾¾çš„å¯¹è±¡</p></li><li><p>è½¯å¼•ç”¨é€šå¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ã€‚æ¯”å¦‚ï¼šé«˜é€Ÿç¼“å­˜å°±æœ‰ç”¨åˆ°è½¯å¼•ç”¨ã€‚å¦‚æœè¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œå°±å¯ä»¥æš‚æ—¶ä¿ç•™ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶æ¸…ç†æ‰ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ç¼“å­˜çš„åŒæ—¶ï¼Œä¸ä¼šè€—å°½å†…å­˜ã€‚</p></li><li><p>åƒåœ¾å›æ”¶å™¨åœ¨æŸä¸ªæ—¶åˆ»å†³å®šå›æ”¶è½¯å¯è¾¾çš„å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šæ¸…ç†è½¯å¼•ç”¨ï¼Œå¹¶å¯é€‰åœ°æŠŠå¼•ç”¨å­˜æ”¾åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReference Queueï¼‰ã€‚</p></li><li><p>ç±»ä¼¼å¼±å¼•ç”¨ï¼Œåªä¸è¿‡Javaè™šæ‹Ÿæœºä¼šå°½é‡è®©è½¯å¼•ç”¨çš„å­˜æ´»æ—¶é—´é•¿ä¸€äº›ï¼Œè¿«ä¸å¾—å·²æ‰æ¸…ç†ã€‚</p></li><li><p>ä¸€å¥è¯æ¦‚æ‹¬ï¼šå½“å†…å­˜è¶³å¤Ÿæ—¶ï¼Œä¸ä¼šå›æ”¶è½¯å¼•ç”¨å¯è¾¾çš„å¯¹è±¡ã€‚å†…å­˜ä¸å¤Ÿæ—¶ï¼Œä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯è¾¾å¯¹è±¡</p></li></ol><p>åœ¨JDK1.2ç‰ˆä¹‹åæä¾›äº†SoftReferenceç±»æ¥å®ç°è½¯å¼•ç”¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å£°æ˜å¼ºå¼•ç”¨</span>
<span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//é”€æ¯å¼ºå¼•ç”¨</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è½¯å¼•ç”¨ä»£ç ä¸¾ä¾‹</strong></p><p>ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SoftReferenceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;[id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;, name=&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆ›å»ºå¯¹è±¡ï¼Œå»ºç«‹è½¯å¼•ç”¨</span>
<span class="token comment">//        SoftReference&lt;User&gt; userSoftRef = new SoftReference&lt;User&gt;(new User(1, &quot;songhk&quot;));</span>
        <span class="token comment">//ä¸Šé¢çš„ä¸€è¡Œä»£ç ï¼Œç­‰ä»·äºå¦‚ä¸‹çš„ä¸‰è¡Œä»£ç </span>
        <span class="token class-name">User</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;songhk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userSoftRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        u1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//å–æ¶ˆå¼ºå¼•ç”¨</span>


        <span class="token comment">//ä»è½¯å¼•ç”¨ä¸­é‡æ–°è·å¾—å¼ºå¼•ç”¨å¯¹è±¡</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userSoftRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---ç›®å‰å†…å­˜è¿˜ä¸ç´§å¼ ---&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After GC:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        //åƒåœ¾å›æ”¶ä¹‹åè·å¾—è½¯å¼•ç”¨ä¸­çš„å¯¹è±¡</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userSoftRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”±äºå †ç©ºé—´å†…å­˜è¶³å¤Ÿï¼Œæ‰€æœ‰ä¸ä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯è¾¾å¯¹è±¡ã€‚</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---ä¸‹é¢å¼€å§‹å†…å­˜ç´§å¼ äº†---&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//è®©ç³»ç»Ÿè®¤ä¸ºå†…å­˜èµ„æºç´§å¼ ã€ä¸å¤Ÿ</span>
<span class="token comment">//            byte[] b = new byte[1024 * 1024 * 7];</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">7168</span> <span class="token operator">-</span> <span class="token number">635</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">//å†æ¬¡ä»è½¯å¼•ç”¨ä¸­è·å–æ•°æ®</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userSoftRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨æŠ¥OOMä¹‹å‰ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯è¾¾å¯¹è±¡ã€‚</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JVMå‚æ•°</p><p><code>-Xms10m -Xmx10m</code></p><p>åœ¨ JVM å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šæ¸…ç†è½¯å¼•ç”¨å¯¹è±¡</p><p>è¾“å‡ºç»“æœï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>songhk<span class="token punctuation">]</span> 
<span class="token operator">--</span><span class="token operator">-</span>ç›®å‰å†…å­˜è¿˜ä¸ç´§å¼ <span class="token operator">--</span><span class="token operator">-</span>
<span class="token class-name">After</span> <span class="token constant">GC</span><span class="token operator">:</span>
<span class="token punctuation">[</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>songhk<span class="token punctuation">]</span> 
<span class="token operator">--</span><span class="token operator">-</span>ä¸‹é¢å¼€å§‹å†…å­˜ç´§å¼ äº†<span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">null</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span><span class="token operator">:</span> <span class="token class-name">Java</span> heap space
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>java1<span class="token punctuation">.</span></span>SoftReferenceTest</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">SoftReferenceTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å†è°ˆå¼•ç”¨-å¼±å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#å†è°ˆå¼•ç”¨-å¼±å¼•ç”¨" aria-hidden="true">#</a> å†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨</h2><blockquote><p><strong>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰å‘ç°å³å›æ”¶</strong></p></blockquote><ol><li><p>å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°é‚£äº›éå¿…éœ€å¯¹è±¡ï¼Œ<strong>åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¸ºæ­¢ã€‚åœ¨ç³»ç»ŸGCæ—¶ï¼Œåªè¦å‘ç°å¼±å¼•ç”¨ï¼Œä¸ç®¡ç³»ç»Ÿå †ç©ºé—´ä½¿ç”¨æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡</strong>ã€‚</p></li><li><p>ä½†æ˜¯ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨çš„çº¿ç¨‹é€šå¸¸ä¼˜å…ˆçº§å¾ˆä½ï¼Œå› æ­¤ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾ˆå¿«åœ°å‘ç°æŒæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼±å¼•ç”¨å¯¹è±¡å¯ä»¥å­˜åœ¨è¾ƒé•¿çš„æ—¶é—´ã€‚</p></li><li><p>å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨ä¸€æ ·ï¼Œåœ¨æ„é€ å¼±å¼•ç”¨æ—¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œå½“å¼±å¼•ç”¨å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå°±ä¼šåŠ å…¥æŒ‡å®šçš„å¼•ç”¨é˜Ÿåˆ—ï¼Œé€šè¿‡è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p></li><li><p>è½¯å¼•ç”¨ã€å¼±å¼•ç”¨éƒ½éå¸¸é€‚åˆæ¥ä¿å­˜é‚£äº›å¯æœ‰å¯æ— çš„ç¼“å­˜æ•°æ®ã€‚å¦‚æœè¿™ä¹ˆåšï¼Œå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®ä¼šè¢«å›æ”¶ï¼Œä¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è€Œå½“å†…å­˜èµ„æºå……è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®åˆå¯ä»¥å­˜åœ¨ç›¸å½“é•¿çš„æ—¶é—´ï¼Œä»è€Œèµ·åˆ°åŠ é€Ÿç³»ç»Ÿçš„ä½œç”¨ã€‚</p></li></ol><p>åœ¨JDK1.2ç‰ˆä¹‹åæä¾›äº†WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å£°æ˜å¼ºå¼•ç”¨</span>
<span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//é”€æ¯å¼ºå¼•ç”¨</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼±å¼•ç”¨å¯¹è±¡ä¸è½¯å¼•ç”¨å¯¹è±¡çš„æœ€å¤§ä¸åŒå°±åœ¨äºï¼Œå½“GCåœ¨è¿›è¡Œå›æ”¶æ—¶ï¼Œéœ€è¦é€šè¿‡ç®—æ³•æ£€æŸ¥æ˜¯å¦å›æ”¶è½¯å¼•ç”¨å¯¹è±¡ï¼Œè€Œå¯¹äºå¼±å¼•ç”¨å¯¹è±¡ï¼ŒGCæ€»æ˜¯è¿›è¡Œå›æ”¶ã€‚å¼±å¼•ç”¨å¯¹è±¡æ›´å®¹æ˜“ã€æ›´å¿«è¢«GCå›æ”¶ã€‚</p><p><strong>é¢è¯•é¢˜ï¼šä½ å¼€å‘ä¸­ä½¿ç”¨è¿‡WeakHashMapå—ï¼Ÿ</strong></p><p><strong>å¼±å¼•ç”¨ä»£ç ä¸¾ä¾‹</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeakReferenceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;[id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;, name=&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ„é€ äº†å¼±å¼•ç”¨</span>
        <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userWeakRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;songhk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä»å¼±å¼•ç”¨ä¸­é‡æ–°è·å–å¯¹è±¡</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userWeakRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After GC:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é‡æ–°å°è¯•ä»å¼±å¼•ç”¨ä¸­è·å–å¯¹è±¡</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userWeakRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œåƒåœ¾å›æ”¶åï¼Œè½¯å¼•ç”¨å¯¹è±¡å¿…å®šè¢«æ¸…é™¤</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>songhk<span class="token punctuation">]</span> 
<span class="token class-name">After</span> <span class="token constant">GC</span><span class="token operator">:</span>
<span class="token keyword">null</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å†è°ˆå¼•ç”¨-è™šå¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#å†è°ˆå¼•ç”¨-è™šå¼•ç”¨" aria-hidden="true">#</a> å†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨</h2><p><strong>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰ï¼šå¯¹è±¡å›æ”¶è·Ÿè¸ª</strong></p><ol><li><p>ä¹Ÿç§°ä¸ºâ€œå¹½çµå¼•ç”¨â€æˆ–è€…â€œå¹»å½±å¼•ç”¨â€ï¼Œæ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹ä¸­æœ€å¼±çš„ä¸€ä¸ª</p></li><li><p>ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå’Œæ²¡æœ‰å¼•ç”¨å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéšæ—¶éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p></li><li><p>å®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å½“è¯•å›¾é€šè¿‡è™šå¼•ç”¨çš„get()æ–¹æ³•å–å¾—å¯¹è±¡æ—¶ï¼Œæ€»æ˜¯null ã€‚<strong>å³é€šè¿‡è™šå¼•ç”¨æ— æ³•è·å–åˆ°æˆ‘ä»¬çš„æ•°æ®</strong></p></li><li><p><strong>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åœ¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼šèƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</strong></p></li><li><p>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚è™šå¼•ç”¨åœ¨åˆ›å»ºæ—¶å¿…é¡»æä¾›ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä½œä¸ºå‚æ•°ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡åï¼Œå°†è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p></li><li><p>ç”±äºè™šå¼•ç”¨å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æ—¶é—´ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥å°†ä¸€äº›èµ„æºé‡Šæ”¾æ“ä½œæ”¾ç½®åœ¨è™šå¼•ç”¨ä¸­æ‰§è¡Œå’Œè®°å½•ã€‚</p></li></ol><p>åœ¨JDK1.2ç‰ˆä¹‹åæä¾›äº†PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å£°æ˜å¼ºå¼•ç”¨</span>
<span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å£°æ˜å¼•ç”¨é˜Ÿåˆ—</span>
<span class="token class-name">ReferenceQueue</span> phantomQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å£°æ˜è™šå¼•ç”¨ï¼ˆè¿˜éœ€è¦ä¼ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼‰</span>
<span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> phantomQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è™šå¼•ç”¨ä»£ç ç¤ºä¾‹</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhantomReferenceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PhantomReferenceTest</span> obj<span class="token punctuation">;</span><span class="token comment">//å½“å‰ç±»å¯¹è±¡çš„å£°æ˜</span>
    <span class="token keyword">static</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">&gt;</span></span> phantomQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//å¼•ç”¨é˜Ÿåˆ—</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CheckRefQueue</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>phantomQueue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">&gt;</span></span> objt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        objt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> phantomQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>objt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿½è¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼šPhantomReferenceTestå®ä¾‹è¢«GCäº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span> <span class="token comment">//finalize()æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨å½“å‰ç±»çš„finalize()æ–¹æ³•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheckRefQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼šå½“ç¨‹åºä¸­æ²¡æœ‰éå®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°±æ‰§è¡Œç»“æŸã€‚</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        phantomQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ„é€ äº† PhantomReferenceTest å¯¹è±¡çš„è™šå¼•ç”¨ï¼Œå¹¶æŒ‡å®šäº†å¼•ç”¨é˜Ÿåˆ—</span>
        <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">&gt;</span></span> phantomRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> phantomQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ä¸å¯è·å–è™šå¼•ç”¨ä¸­çš„å¯¹è±¡</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phantomRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬ 1 æ¬¡ gc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å°†å¼ºå¼•ç”¨å»é™¤</span>
            obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token comment">//ç¬¬ä¸€æ¬¡è¿›è¡ŒGC,ç”±äºå¯¹è±¡å¯å¤æ´»ï¼ŒGCæ— æ³•å›æ”¶è¯¥å¯¹è±¡</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;obj æ˜¯ null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;obj å¯ç”¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬ 2 æ¬¡ gc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸€æ—¦å°†objå¯¹è±¡å›æ”¶ï¼Œå°±ä¼šå°†æ­¤è™šå¼•ç”¨å­˜æ”¾åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;obj æ˜¯ null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;obj å¯ç”¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1ã€ç¬¬ä¸€æ¬¡å°è¯•è·å–è™šå¼•ç”¨çš„å€¼ï¼Œå‘ç°æ— æ³•è·å–çš„ï¼Œè¿™æ˜¯å› ä¸ºè™šå¼•ç”¨æ˜¯æ— æ³•ç›´æ¥è·å–å¯¹è±¡çš„å€¼ï¼Œç„¶åè¿›è¡Œç¬¬ä¸€æ¬¡GCï¼Œå› ä¸ºä¼šè°ƒç”¨finalizeæ–¹æ³•ï¼Œå°†å¯¹è±¡å¤æ´»äº†ï¼Œæ‰€ä»¥å¯¹è±¡æ²¡æœ‰è¢«å›æ”¶</p><p>2ã€ä½†æ˜¯è°ƒç”¨ç¬¬äºŒæ¬¡GCæ“ä½œçš„æ—¶å€™ï¼Œå› ä¸ºfinalizeæ–¹æ³•åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å°±è§¦å‘äº†GCæ“ä½œï¼Œå°†å¯¹è±¡å›æ”¶äº†ï¼ŒåŒæ—¶å°†ä¼šè§¦å‘ç¬¬äºŒä¸ªæ“ä½œå°±æ˜¯å°†å¾…å›æ”¶çš„å¯¹è±¡å­˜å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p>è¾“å‡ºç»“æœï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">null</span>
ç¬¬ <span class="token number">1</span> æ¬¡ gc
è°ƒç”¨å½“å‰ç±»çš„<span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•
obj å¯ç”¨
ç¬¬ <span class="token number">2</span> æ¬¡ gc
è¿½è¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼š<span class="token class-name">PhantomReferenceTest</span>å®ä¾‹è¢«<span class="token constant">GC</span>äº†
obj æ˜¯ <span class="token keyword">null</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å†è°ˆå¼•ç”¨-ç»ˆç»“å™¨å¼•ç”¨-äº†è§£" tabindex="-1"><a class="header-anchor" href="#å†è°ˆå¼•ç”¨-ç»ˆç»“å™¨å¼•ç”¨-äº†è§£" aria-hidden="true">#</a> å†è°ˆå¼•ç”¨ï¼šç»ˆç»“å™¨å¼•ç”¨ï¼ˆäº†è§£ï¼‰</h2><ol><li><p>å®ƒç”¨äºå®ç°å¯¹è±¡çš„finalize() æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºç»ˆç»“å™¨å¼•ç”¨</p></li><li><p>æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œå…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨</p></li><li><p>åœ¨GCæ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿã€‚ç”±Finalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡è°ƒç”¨å®ƒçš„finalize()æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡GCæ—¶æ‰å›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡</p></li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://gitee.com/lizifan233/mydocs/edit/master/src/codenotes/Java/jvm/11.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ã€Giteeã€‘ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ã€Giteeã€‘ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></footer><nav class="page-nav"><a href="/codenotes/Java/jvm/10.html" class="nav-link prev" aria-label="JVMç³»åˆ—-ç¬¬10ç« -åƒåœ¾å›æ”¶æ¦‚è¿°å’Œç›¸å…³ç®—æ³•"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->JVMç³»åˆ—-ç¬¬10ç« -åƒåœ¾å›æ”¶æ¦‚è¿°å’Œç›¸å…³ç®—æ³•</div></a><a href="/codenotes/Java/jvm/12.html" class="nav-link next" aria-label="JVMç³»åˆ—-ç¬¬12ç« -åƒåœ¾å›æ”¶å™¨"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">JVMç³»åˆ—-ç¬¬12ç« -åƒåœ¾å›æ”¶å™¨<!----></div></a></nav><div class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><!-- eslint-disable-next-line vue/no-v-html --><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button class="wl-btn">ç™»å½•</button><button class="wl-btn primary" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><!-- Copyright Information --><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noreferrer"> Waline </a> v2.14.1</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">å°uã®å­¦ä¹ ç¬”è®°</div><div class="copyright">Copyright Â© 2023 Xiaou</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.c5b3201b.js" defer></script>
  </body>
</html>
